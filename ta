[1mdiff --git a/tinyspriteeditor.html b/tinyspriteeditor.html[m
[1mindex ed04080..f4ab9b8 100644[m
[1m--- a/tinyspriteeditor.html[m
[1m+++ b/tinyspriteeditor.html[m
[36m@@ -1,1964 +1,3 @@[m
[31m-<html>[m
[31m-<head>[m
[31m-<meta charset="utf-8">[m
[31m-<meta name="viewport" content="initial-scale=1">[m
[31m-<title>Tiny sprite editor 20160530 by Boris van Schooten</title>[m
[31m-<style>[m
 [m
[31m-button, select, option {[m
[31m-	font-size: 110%;[m
[31m-}[m
[31m-[m
[31m-input.number {[m
[31m-	width: 40px;[m
[31m-}[m
[31m-input.color {[m
[31m-	width: 85px;[m
[31m-}[m
[31m-div.pixel {[m
[31m-}[m
[31m-[m
[31m-input[type="file"] {[m
[31m-    display: none;[m
[31m-}[m
[31m-[m
[31m-.anchorbutton {[m
[31m-	font-family: "Ubuntu";[m
[31m-	padding: 3px 10px 2px 10px;[m
[31m-	color: #4c4c4c;[m
[31m-	background-color: #e2e2e2;[m
[31m-    background: -webkit-gradient(linear, left top, left bottom, from(#eeeeee), to(#dddddd));[m
[31m-    background: -moz-linear-gradient(top,  #eeeeee,  #dddddd);[m
[31m-	text-decoration: none;[m
[31m-	border: 1px outset #888888;[m
[31m-	border-radius: 4px;[m
[31m-	font-size: 110%;[m
[31m-}[m
[31m-[m
[31m-.spritezoom {[m
[31m-	margin-left: 20px;[m
[31m-	margin-bottom: 20px;[m
[31m-	float: left;[m
[31m-}[m
[31m-[m
[31m-.sprite-bg {[m
[31m-	/* this class is also used to set background style through JS */[m
[31m-/*	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAHklEQVQYlWNwcHD4n5CQ8B8XzYBP0sHB4T/DsDABAJIZe8ESbb4LAAAAAElFTkSuQmCC');[m
[31m-*/[m
[31m-/*	background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+AFFQoIHkr2q0IAAAAjSURBVBjTY/z///9EBlSgj8xhYiAAKFfAgm4nAwPDRTq7AQBMegTPiNorbQAAAABJRU5ErkJggg=="), linear-gradient(to bottom, #ff0000 0%, #ff0000 100%);*/[m
[31m-	z-index: -2;[m
[31m-}[m
[31m-[m
[31m-.onionskin-bg {[m
[31m-}[m
[31m-[m
[31m-.zoomcontainer {[m
[31m-	float: left;[m
[31m-	margin-left: 20px;[m
[31m-}[m
[31m-[m
[31m-.zoomcontainer button,[m
[31m-.zoomcontainer input {[m
[31m-	margin-top: 4px;[m
[31m-	margin-bottom: 4px;[m
[31m-}[m
[31m-[m
[31m-.buttoncontainer {[m
[31m-	float: left;[m
[31m-}[m
[31m-[m
[31m-.noselect {[m
[31m-  -webkit-touch-callout: none; /* iOS Safari */[m
[31m-  -webkit-user-select: none;   /* Chrome/Safari/Opera */[m
[31m-  -khtml-user-select: none;    /* Konqueror */[m
[31m-  -moz-user-select: none;      /* Firefox */[m
[31m-  -ms-user-select: none;       /* Internet Explorer/Edge */[m
[31m-  user-select: none;           /* Non-prefixed version, currently[m
[31m-                                  not supported by any browser */[m
[31m-}[m
[31m-[m
[31m-.popup {[m
[31m-	position: absolute;[m
[31m-	margin-top: 10px;[m
[31m-	margin-left: 10px;[m
[31m-	padding: 10px;[m
[31m-	background-color: #ccc;[m
[31m-	color: #000;[m
[31m-	border: 4px outset black;[m
[31m-	z-index: 10;[m
[31m-	display: none;[m
[31m-}[m
[31m-[m
[31m-.closepopup {[m
[31m-	position: absolute;[m
[31m-	font-size: 240%;[m
[31m-	color: #000;[m
[31m-	background-color: #f22;[m
[31m-	top: -15px;[m
[31m-	left: -15px;[m
[31m-	border: 2px solid #000;[m
[31m-	border-radius: 50%;[m
[31m-	cursor: pointer;[m
[31m-	width: 40px;[m
[31m-	height: 40px;[m
[31m-	text-align: center;[m
[31m-}[m
[31m-[m
[31m-.popup-form {[m
[31m-	border: 3px outset black;[m
[31m-	background-color: #eee;[m
[31m-	color: #000;[m
[31m-	padding: 10px;[m
[31m-	margin: 10px;[m
[31m-}[m
[31m-[m
[31m-.commandline {[m
[31m-	display: none;[m
[31m-	position:relative;[m
[31m-	height: 0px;[m
[31m-	top: 10px;[m
[31m-}[m
[31m-[m
[31m-.commandline span {[m
[31m-	background-color: #ff0;[m
[31m-	border: 1px solid black;[m
[31m-	border-radius: 5px;[m
[31m-	padding-left: 20px;[m
[31m-	padding-right: 15px;[m
[31m-}[m
[31m-.commandline-bubble {[m
[31m-    border-style: solid;[m
[31m-    position: absolute;[m
[31m-    border-color: transparent transparent #ff0 transparent;[m
[31m-    border-width: 8px;[m
[31m-	left: 25px;[m
[31m-    top: -16px;[m
[31m-	pointer-events:none;[m
[31m-}[m
[31m-[m
[31m-.closecommand {[m
[31m-	position: absolute;[m
[31m-	font-size: 150%;[m
[31m-	color: #000;[m
[31m-	background-color: #f22;[m
[31m-	top: -5px;[m
[31m-	left: -15px;[m
[31m-	border: 2px solid #000;[m
[31m-	border-radius: 50%;[m
[31m-	cursor: pointer;[m
[31m-	width: 25px;[m
[31m-	height: 25px;[m
[31m-	text-align: center;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-[m
[31m-.tilepreview,[m
[31m-.animpreview {[m
[31m-	margin-top: 10px;[m
[31m-	margin-bottom: 10px;[m
[31m-	border: 1px solid black;[m
[31m-	padding: 5px;[m
[31m-	text-align: center;[m
[31m-}[m
[31m-[m
[31m-.palette {[m
[31m-	float: left;[m
[31m-	margin-bottom: 5px;[m
[31m-}[m
[31m-[m
[31m-.pencolor {[m
[31m-	width: 80px;[m
[31m-	height: 30px;[m
[31m-	border: 1px solid black;[m
[31m-}[m
[31m-[m
[31m-.pencolor-bg {[m
[31m-	position: relative;[m
[31m-	width: 80px;[m
[31m-	height: 30px;[m
[31m-}[m
[31m-[m
[31m-</style>[m
[31m-</head>[m
[31m-<body style="background-color: #ccc;">[m
[31m-[m
[31m-<div id="settings" class="popup">[m
[31m-	<div class="closepopup noselect" onclick="openPopup('settings',false)">×</div>[m
[31m-	<div style="padding-left: 20px; text-align: center; font-style: italic;"[m
[31m-	>Tiny sprite editor 20160530 by Boris van Schooten.<br>[m
[31m-	<a href="http://tmtg.net/tinyspriteeditor/" target="_blank">Homepage.</a>[m
[31m-	<a href="https://opensource.org/licenses/BSD-3-ClauseRevised"[m
[31m-	target="_blank">BSD license.</a>[m
[31m-	Download me and run locally! [m
[31m-	<a href="https://github.com/borisvanschooten/tinyspriteeditor"[m
[31m-	target="_blank">Modify me!</a>[m
[31m-	</div>[m
[31m-	<div style="padding-left: 20px; font-weight:bold; font-size:120%;"[m
[31m-	>Settings</div>[m
[31m-	<div class="popup-form">[m
[31m-		Tile width: <input class="number" id="cfg_tilex" type="textfield" value="12">[m
[31m-		</input>[m
[31m-		Tile height: <input class="number" id="cfg_tiley" type="textfield" value="12">[m
[31m-		</input>[m
[31m-		Nr tiles X: <input class="number" id="cfg_nrtilesx" type="textfield" value="8">[m
[31m-		</input>[m
[31m-		Nr tiles Y: <input class="number" id="cfg_nrtilesy" type="textfield" value="8">[m
[31m-		</input>[m
[31m-		<button onclick="configSetSize();openPopup('settings',false);">Create new canvas</button>[m
[31m-	</div>[m
[31m-[m
[31m-	<div class="popup-form">[m
[31m-		Color for transparent background:[m
[31m-		<input class="color" id="transparentcolor" type="textfield" value="#444">[m
[31m-		</input>[m
[31m-		<input type="checkbox" id="transparentchecker" checked="checked"> Use checkerboard</input>[m
[31m-		<button onclick="configSpriteBG();openPopup('settings',false);">Set !</button>[m
[31m-	</div>[m
[31m-[m
[31m-	<div class="popup-form">[m
[31m-		Grid: color[m
[31m-		<input class="color" id="gridcolor" type="textfield" value="#000">[m
[31m-		</input>[m
[31m-		thickness[m
[31m-		<input class="number" id="gridthickness" type="textfield" value="1">[m
[31m-		</input>[m
[31m-		Sprite select box color:[m
[31m-		<input class="color" id="selectboxcolor" type="textfield" value="#ff0">[m
[31m-		</input>[m
[31m-		<button onclick="configGrid();openPopup('settings',false);">Set !</button>[m
[31m-	</div>[m
[31m-[m
[31m-	<div class="popup-form">[m
[31m-		Enlarged image zoom:[m
[31m-		<input class="number" id="sprzoomlevel" type="textfield" value="4">[m
[31m-		</input>[m
[31m-		Edit area zoom:[m
[31m-		<input class="number" id="zoomlevel" type="textfield" value="28">[m
[31m-		</input>[m
[31m-		<button onclick="configZoom();openPopup('settings',false);">Set !</button>[m
[31m-	</div>[m
[31m-[m
[31m-	<div class="popup-form">[m
[31m-		Global background color:[m
[31m-		<input class="color" id="globalbackground" type="textfield" value="#ddd">[m
[31m-		</input>[m
[31m-		Global foreground color:[m
[31m-		<input class="color" id="globalforeground" type="textfield" value="#000">[m
[31m-		</input>[m
[31m-		<button onclick="configGlobal();openPopup('settings',false);">Set !</button>[m
[31m-	</div>[m
[31m-[m
[31m-	<div class="popup-form">[m
[31m-		Onion skin: transparency:[m
[31m-		<input class="number" id="onionskinbgtrans" type="textfield" value="1.0">[m
[31m-		</input>[m
[31m-		size:[m
[31m-		<input class="number" id="onionskinsize" type="textfield" value="0.33">[m
[31m-		</input>[m
[31m-		<button onclick="configOnionSkin();openPopup('settings',false);">Set !</button>[m
[31m-	</div>[m
[31m-[m
[31m-</div>[m
[31m-[m
[31m-[m
[31m-[m
[31m-<div id="animation" class="popup">[m
[31m-	<div class="closepopup noselect" onclick="openPopup('animation',false)">×</div>[m
[31m-	<div style="padding-left: 20px; font-weight:bold; font-size:120%;"[m
[31m-	>Animation Settings</div>[m
[31m-	<div class="popup-form">[m
[31m-		<div style="padding-top: 10px;"></div>[m
[31m-		Delay (milliseconds):[m
[31m-		<input class="color" id="animdelay" type="textfield" value="200">[m
[31m-		</input>[m
[31m-		<div style="padding-top: 10px;"></div>[m
[31m-		<input type="checkbox" id="animpingpong"></input> Ping-pong animation[m
[31m-		<div style="padding-top: 10px; text-align:center;">[m
[31m-			<button onclick="configAnim();openPopup('settings',false);">Set ![m
[31m-			</button>[m
[31m-		</div>[m
[31m-	</div>[m
[31m-</div>[m
[31m-[m
[31m-[m
[31m-<div class="sprite" style="float:left;">[m
[31m-	<div id="tileselect" style="position: relative; width:0px; height:0px;">[m
[31m-		<div id="tileselectbox"[m
[31m-		style="position:relative; width:8px; height:8px; border: 1px solid green;"[m
[31m-		></div>[m
[31m-	</div>[m
[31m-	<canvas id="sprite" class="sprite-bg" width=40 height=40 style="border: 1px solid black;">[m
[31m-	</canvas>[m
[31m-[m
[31m-	<div class="tilepreview">[m
[31m-	<canvas id="tilepreview" class="sprite-bg" width=36 height=36 style="border: 1px solid black;"></canvas>[m
[31m-	<div style="padding: 5px;"></div>[m
[31m-	<canvas id="tilepreview_l" class="sprite-bg" width=36 height=36 style="border: 1px solid black;"></canvas>[m
[31m-	<div style="padding: 5px;"></div>[m
[31m-	Tiling preview[m
[31m-	</div>[m
[31m-[m
[31m-	<div class="animpreview">[m
[31m-	<canvas id="animpreview" class="sprite-bg" width=12 height=12 style="border: 1px solid black;"></canvas>[m
[31m-	<div style="padding: 5px;"></div>[m
[31m-	<canvas id="animpreview_l" class="sprite-bg" width=36 height=36 style="border: 1px solid black;"></canvas>[m
[31m-	<div style="padding: 5px;"></div>[m
[31m-	Animation[m
[31m-	<div style="padding-top: 5px;"></div>[m
[31m-	<button id="animtoggle" [m
[31m-	style="padding-left: 0px; padding-right:0px; width: 55px;"[m
[31m-	 onclick="toggleAnimation()">Play</button>[m
[31m-	<button onclick="openPopup('animation',true);">⚙ Settings</button>[m
[31m-	<div></div>[m
[31m-	Set[m
[31m-	<button style="padding-left: 0px; padding-right:0px;"[m
[31m-	 onclick="setAnimFrame('start')">Start</button>[m
[31m-	<button style="padding-left: 0px; padding-right:0px;"[m
[31m-	 onclick="setAnimFrame('end')">End</button>[m
[31m-	</div>[m
[31m-[m
[31m-</div>[m
[31m-[m
[31m-<div class="spritezoom">[m
[31m-	<div id="tileselect_l" style="position: relative; width:0px; height:0px;">[m
[31m-		<div id="tileselect_lbox"[m
[31m-		style="position:relative; width:8px; height:8px; border: 1px solid green;"[m
[31m-		></div>[m
[31m-	</div>[m
[31m-	<canvas id="sprite_l" class="sprite-bg" width=40 height=40 style="border: 1px solid black;">[m
[31m-	</canvas>[m
[31m-</div>[m
[31m-[m
[31m-<div class="zoomcontainer">[m
[31m-	<div style="float:right;">[m
[31m-		<button style="margin-left: 15px;" onclick="retrieveHistory(false)">Undo</button>[m
[31m-		<div></div>[m
[31m-		<button style="margin-left: 15px;" onclick="retrieveHistory(true)">Redo</button>[m
[31m-		<div></div>[m
[31m-		<button style="margin-left: 15px;" onclick="cutSprite()">Cut</button>[m
[31m-		<div></div>[m
[31m-		<button style="margin-left: 15px;" onclick="copySprite()">Copy</button>[m
[31m-		<div></div>[m
[31m-		<button style="margin-left: 15px;" onclick="pasteSprite()">Paste</button>[m
[31m-		<div></div>[m
[31m-		<button style="margin-left: 15px;" onclick="mergeSprite()">Merge</button>[m
[31m-		<div></div>[m
[31m-		<input id="setonionskin" type="checkbox" style="margin-left: 15px;" onchange="setOnionSkin()">Onion Skin</input>[m
[31m-	</div>[m
[31m-	<div id="zoom" style="float:left;">[m
[31m-	</div>[m
[31m-	<div style="clear:both; padding-bottom: 35px;">[m
[31m-		<div style="position:relative; height: 0px; top:5px;">[m
[31m-			name: <input id="spritenameline" type="textfield"[m
[31m-			 style="background-color: transparent;"[m
[31m-			 onchange="storeSpriteNameLine()"></input>[m
[31m-		</div>[m
[31m-		<div id="commandline" class="commandline">[m
[31m-			<div class="commandline-bubble"></div>[m
[31m-			<div class="closecommand noselect" onclick="closeCommand()">×</div>[m
[31m-			<span id="commandline-text"></span>[m
[31m-		</div>[m
[31m-	</div>[m
[31m-	<div id="palette" class="palette">[m
[31m-	</div>[m
[31m-	<div style="float:left; margin-left: 10px;">[m
[31m-		<div id="pencolor" class="pencolor">[m
[31m-			<div style="position: relative; width:0px; height:0px;">[m
[31m-				<div id="pencolor-bg" class="pencolor-bg sprite-bg"></div>[m
[31m-			</div>[m
[31m-		</div>[m
[31m-		<div>[m
[31m-			<input type="textfield" class="color" id="pencolor-text"[m
[31m-			 onchange="setPenColorFromText();"></input>[m
[31m-		</div>[m
[31m-		<button onclick="startCommand('PickPenColor');">Pick color</button>[m
[31m-		<div style="padding-bottom: 5px;">[m
[31m-			Palette:<br>[m
[31m-			<select id="palettename" style="font-size:100%;" onchange="setPalette(this)">[m
[31m-				<option value="Standard">Standard</option>[m
[31m-				<option value="NES">NES 8bit</option>[m
[31m-				<option value="Comic">Comic</option>[m
[31m-				<option value="Pico8">Pico 8</option>[m
[31m-				<option value="CBM64">CBM 64</option>[m
[31m-				<option value="Puzzlescript">puzzlescript</option>[m
[31m-			</select>[m
[31m-		</div>[m
[31m-	</div>[m
[31m-[m
[31m-</div>[m
[31m-[m
[31m-[m
[31m-[m
[31m-[m
[31m-[m
[31m-[m
[31m-<div style="clear:both" ></div>[m
[31m-[m
[31m-<div class="buttoncontainer">[m
[31m-	<button onclick="openPopup('settings',true)"[m
[31m-	 style="margin-top: 10px; margin-right: 10px; font-size:160%; background-color: #f88; float:left;">⚙ Settings</button>[m
[31m-	<button onclick="createOutline()">Outline</button>[m
[31m-	<button onclick="startCommand('ReplaceColor')">Replace color</button>[m
[31m-	Delete: [m
[31m-	<button onclick="startCommand('DelRow')">row</button>[m
[31m-	<button onclick="startCommand('DelColumn')">column</button>[m
[31m-	Insert: [m
[31m-	<button onclick="startCommand('InsRow')">row</button>[m
[31m-	<button onclick="startCommand('InsColumn')">column</button>[m
[31m-	Rorschach:[m
[31m-	<button onclick="copyMirrorX()">X</button>[m
[31m-	<button onclick="copyMirrorY()">Y</button>[m
[31m-	<div></div>[m
[31m-	Flood fill:[m
[31m-	<button onclick="startCommand('FloodFill4')">4-way</button>[m
[31m-	<button onclick="startCommand('FloodFill8')">8-way</button>[m
[31m-	<button onclick="shiftSprite(-1,0)">⇐</button>[m
[31m-	<button onclick="shiftSprite(1,0)">⇒</button>[m
[31m-	<button onclick="shiftSprite(0,-1)">⇑</button>[m
[31m-	<button onclick="shiftSprite(0,1)">⇓</button>[m
[31m-	<button onclick="flipSprite(false)">↔</button>[m
[31m-	<button onclick="flipSprite(true)">↕</button>[m
[31m-	<button onclick="rotSprite(1)">↻</button>[m
[31m-	<button onclick="rotSprite(-1)" style="margin-right: 30px;">↺</button>[m
[31m-</div>[m
[31m-[m
[31m-<div style="clear:both;" ></div>[m
[31m-[m
[31m-<di