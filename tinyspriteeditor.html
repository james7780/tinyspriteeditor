
<!-- saved from url=(0054)http://tmtg.net/tinyspriteeditor/tinyspriteeditor.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><div class="line-gutter-backdrop"></div><table><tbody><tr><td class="line-number" value="1"></td><td class="line-content"><span class="html-tag">&lt;html&gt;</span></td></tr><tr><td class="line-number" value="2"></td><td class="line-content"><span class="html-tag">&lt;head&gt;</span></td></tr><tr><td class="line-number" value="3"></td><td class="line-content"><span class="html-tag">&lt;meta <span class="html-attribute-name">charset</span>="<span class="html-attribute-value">utf-8</span>"&gt;</span></td></tr><tr><td class="line-number" value="4"></td><td class="line-content"><span class="html-tag">&lt;meta <span class="html-attribute-name">name</span>="<span class="html-attribute-value">viewport</span>" <span class="html-attribute-name">content</span>="<span class="html-attribute-value">initial-scale=1</span>"&gt;</span></td></tr><tr><td class="line-number" value="5"></td><td class="line-content"><span class="html-tag">&lt;title&gt;</span>Tiny sprite editor 20160530 by Boris van Schooten<span class="html-tag">&lt;/title&gt;</span></td></tr><tr><td class="line-number" value="6"></td><td class="line-content"><span class="html-tag">&lt;style&gt;</span></td></tr><tr><td class="line-number" value="7"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="8"></td><td class="line-content">button, select, option {</td></tr><tr><td class="line-number" value="9"></td><td class="line-content">	font-size: 110%;</td></tr><tr><td class="line-number" value="10"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="11"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="12"></td><td class="line-content">input.number {</td></tr><tr><td class="line-number" value="13"></td><td class="line-content">	width: 40px;</td></tr><tr><td class="line-number" value="14"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="15"></td><td class="line-content">input.color {</td></tr><tr><td class="line-number" value="16"></td><td class="line-content">	width: 85px;</td></tr><tr><td class="line-number" value="17"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="18"></td><td class="line-content">div.pixel {</td></tr><tr><td class="line-number" value="19"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="20"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="21"></td><td class="line-content">input[type="file"] {</td></tr><tr><td class="line-number" value="22"></td><td class="line-content">    display: none;</td></tr><tr><td class="line-number" value="23"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="24"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="25"></td><td class="line-content">.anchorbutton {</td></tr><tr><td class="line-number" value="26"></td><td class="line-content">	font-family: "Ubuntu";</td></tr><tr><td class="line-number" value="27"></td><td class="line-content">	padding: 3px 10px 2px 10px;</td></tr><tr><td class="line-number" value="28"></td><td class="line-content">	color: #4c4c4c;</td></tr><tr><td class="line-number" value="29"></td><td class="line-content">	background-color: #e2e2e2;</td></tr><tr><td class="line-number" value="30"></td><td class="line-content">    background: -webkit-gradient(linear, left top, left bottom, from(#eeeeee), to(#dddddd));</td></tr><tr><td class="line-number" value="31"></td><td class="line-content">    background: -moz-linear-gradient(top,  #eeeeee,  #dddddd);</td></tr><tr><td class="line-number" value="32"></td><td class="line-content">	text-decoration: none;</td></tr><tr><td class="line-number" value="33"></td><td class="line-content">	border: 1px outset #888888;</td></tr><tr><td class="line-number" value="34"></td><td class="line-content">	border-radius: 4px;</td></tr><tr><td class="line-number" value="35"></td><td class="line-content">	font-size: 110%;</td></tr><tr><td class="line-number" value="36"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="37"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="38"></td><td class="line-content">.spritezoom {</td></tr><tr><td class="line-number" value="39"></td><td class="line-content">	margin-left: 20px;</td></tr><tr><td class="line-number" value="40"></td><td class="line-content">	margin-bottom: 20px;</td></tr><tr><td class="line-number" value="41"></td><td class="line-content">	float: left;</td></tr><tr><td class="line-number" value="42"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="43"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="44"></td><td class="line-content">.sprite-bg {</td></tr><tr><td class="line-number" value="45"></td><td class="line-content">	/* this class is also used to set background style through JS */</td></tr><tr><td class="line-number" value="46"></td><td class="line-content">/*	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAHklEQVQYlWNwcHD4n5CQ8B8XzYBP0sHB4T/DsDABAJIZe8ESbb4LAAAAAElFTkSuQmCC');</td></tr><tr><td class="line-number" value="47"></td><td class="line-content">*/</td></tr><tr><td class="line-number" value="48"></td><td class="line-content">/*	background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+AFFQoIHkr2q0IAAAAjSURBVBjTY/z///9EBlSgj8xhYiAAKFfAgm4nAwPDRTq7AQBMegTPiNorbQAAAABJRU5ErkJggg=="), linear-gradient(to bottom, #ff0000 0%, #ff0000 100%);*/</td></tr><tr><td class="line-number" value="49"></td><td class="line-content">	z-index: -2;</td></tr><tr><td class="line-number" value="50"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="51"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="52"></td><td class="line-content">.onionskin-bg {</td></tr><tr><td class="line-number" value="53"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="54"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="55"></td><td class="line-content">.zoomcontainer {</td></tr><tr><td class="line-number" value="56"></td><td class="line-content">	float: left;</td></tr><tr><td class="line-number" value="57"></td><td class="line-content">	margin-left: 20px;</td></tr><tr><td class="line-number" value="58"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="59"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="60"></td><td class="line-content">.zoomcontainer button,</td></tr><tr><td class="line-number" value="61"></td><td class="line-content">.zoomcontainer input {</td></tr><tr><td class="line-number" value="62"></td><td class="line-content">	margin-top: 4px;</td></tr><tr><td class="line-number" value="63"></td><td class="line-content">	margin-bottom: 4px;</td></tr><tr><td class="line-number" value="64"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="65"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="66"></td><td class="line-content">.buttoncontainer {</td></tr><tr><td class="line-number" value="67"></td><td class="line-content">	float: left;</td></tr><tr><td class="line-number" value="68"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="69"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="70"></td><td class="line-content">.noselect {</td></tr><tr><td class="line-number" value="71"></td><td class="line-content">  -webkit-touch-callout: none; /* iOS Safari */</td></tr><tr><td class="line-number" value="72"></td><td class="line-content">  -webkit-user-select: none;   /* Chrome/Safari/Opera */</td></tr><tr><td class="line-number" value="73"></td><td class="line-content">  -khtml-user-select: none;    /* Konqueror */</td></tr><tr><td class="line-number" value="74"></td><td class="line-content">  -moz-user-select: none;      /* Firefox */</td></tr><tr><td class="line-number" value="75"></td><td class="line-content">  -ms-user-select: none;       /* Internet Explorer/Edge */</td></tr><tr><td class="line-number" value="76"></td><td class="line-content">  user-select: none;           /* Non-prefixed version, currently</td></tr><tr><td class="line-number" value="77"></td><td class="line-content">                                  not supported by any browser */</td></tr><tr><td class="line-number" value="78"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="79"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="80"></td><td class="line-content">.popup {</td></tr><tr><td class="line-number" value="81"></td><td class="line-content">	position: absolute;</td></tr><tr><td class="line-number" value="82"></td><td class="line-content">	margin-top: 10px;</td></tr><tr><td class="line-number" value="83"></td><td class="line-content">	margin-left: 10px;</td></tr><tr><td class="line-number" value="84"></td><td class="line-content">	padding: 10px;</td></tr><tr><td class="line-number" value="85"></td><td class="line-content">	background-color: #ccc;</td></tr><tr><td class="line-number" value="86"></td><td class="line-content">	color: #000;</td></tr><tr><td class="line-number" value="87"></td><td class="line-content">	border: 4px outset black;</td></tr><tr><td class="line-number" value="88"></td><td class="line-content">	z-index: 10;</td></tr><tr><td class="line-number" value="89"></td><td class="line-content">	display: none;</td></tr><tr><td class="line-number" value="90"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="91"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="92"></td><td class="line-content">.closepopup {</td></tr><tr><td class="line-number" value="93"></td><td class="line-content">	position: absolute;</td></tr><tr><td class="line-number" value="94"></td><td class="line-content">	font-size: 240%;</td></tr><tr><td class="line-number" value="95"></td><td class="line-content">	color: #000;</td></tr><tr><td class="line-number" value="96"></td><td class="line-content">	background-color: #f22;</td></tr><tr><td class="line-number" value="97"></td><td class="line-content">	top: -15px;</td></tr><tr><td class="line-number" value="98"></td><td class="line-content">	left: -15px;</td></tr><tr><td class="line-number" value="99"></td><td class="line-content">	border: 2px solid #000;</td></tr><tr><td class="line-number" value="100"></td><td class="line-content">	border-radius: 50%;</td></tr><tr><td class="line-number" value="101"></td><td class="line-content">	cursor: pointer;</td></tr><tr><td class="line-number" value="102"></td><td class="line-content">	width: 40px;</td></tr><tr><td class="line-number" value="103"></td><td class="line-content">	height: 40px;</td></tr><tr><td class="line-number" value="104"></td><td class="line-content">	text-align: center;</td></tr><tr><td class="line-number" value="105"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="106"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="107"></td><td class="line-content">.popup-form {</td></tr><tr><td class="line-number" value="108"></td><td class="line-content">	border: 3px outset black;</td></tr><tr><td class="line-number" value="109"></td><td class="line-content">	background-color: #eee;</td></tr><tr><td class="line-number" value="110"></td><td class="line-content">	color: #000;</td></tr><tr><td class="line-number" value="111"></td><td class="line-content">	padding: 10px;</td></tr><tr><td class="line-number" value="112"></td><td class="line-content">	margin: 10px;</td></tr><tr><td class="line-number" value="113"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="114"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="115"></td><td class="line-content">.commandline {</td></tr><tr><td class="line-number" value="116"></td><td class="line-content">	display: none;</td></tr><tr><td class="line-number" value="117"></td><td class="line-content">	position:relative;</td></tr><tr><td class="line-number" value="118"></td><td class="line-content">	height: 0px;</td></tr><tr><td class="line-number" value="119"></td><td class="line-content">	top: 10px;</td></tr><tr><td class="line-number" value="120"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="121"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="122"></td><td class="line-content">.commandline span {</td></tr><tr><td class="line-number" value="123"></td><td class="line-content">	background-color: #ff0;</td></tr><tr><td class="line-number" value="124"></td><td class="line-content">	border: 1px solid black;</td></tr><tr><td class="line-number" value="125"></td><td class="line-content">	border-radius: 5px;</td></tr><tr><td class="line-number" value="126"></td><td class="line-content">	padding-left: 20px;</td></tr><tr><td class="line-number" value="127"></td><td class="line-content">	padding-right: 15px;</td></tr><tr><td class="line-number" value="128"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="129"></td><td class="line-content">.commandline-bubble {</td></tr><tr><td class="line-number" value="130"></td><td class="line-content">    border-style: solid;</td></tr><tr><td class="line-number" value="131"></td><td class="line-content">    position: absolute;</td></tr><tr><td class="line-number" value="132"></td><td class="line-content">    border-color: transparent transparent #ff0 transparent;</td></tr><tr><td class="line-number" value="133"></td><td class="line-content">    border-width: 8px;</td></tr><tr><td class="line-number" value="134"></td><td class="line-content">	left: 25px;</td></tr><tr><td class="line-number" value="135"></td><td class="line-content">    top: -16px;</td></tr><tr><td class="line-number" value="136"></td><td class="line-content">	pointer-events:none;</td></tr><tr><td class="line-number" value="137"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="138"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="139"></td><td class="line-content">.closecommand {</td></tr><tr><td class="line-number" value="140"></td><td class="line-content">	position: absolute;</td></tr><tr><td class="line-number" value="141"></td><td class="line-content">	font-size: 150%;</td></tr><tr><td class="line-number" value="142"></td><td class="line-content">	color: #000;</td></tr><tr><td class="line-number" value="143"></td><td class="line-content">	background-color: #f22;</td></tr><tr><td class="line-number" value="144"></td><td class="line-content">	top: -5px;</td></tr><tr><td class="line-number" value="145"></td><td class="line-content">	left: -15px;</td></tr><tr><td class="line-number" value="146"></td><td class="line-content">	border: 2px solid #000;</td></tr><tr><td class="line-number" value="147"></td><td class="line-content">	border-radius: 50%;</td></tr><tr><td class="line-number" value="148"></td><td class="line-content">	cursor: pointer;</td></tr><tr><td class="line-number" value="149"></td><td class="line-content">	width: 25px;</td></tr><tr><td class="line-number" value="150"></td><td class="line-content">	height: 25px;</td></tr><tr><td class="line-number" value="151"></td><td class="line-content">	text-align: center;</td></tr><tr><td class="line-number" value="152"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="153"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="154"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="155"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="156"></td><td class="line-content">.tilepreview,</td></tr><tr><td class="line-number" value="157"></td><td class="line-content">.animpreview {</td></tr><tr><td class="line-number" value="158"></td><td class="line-content">	margin-top: 10px;</td></tr><tr><td class="line-number" value="159"></td><td class="line-content">	margin-bottom: 10px;</td></tr><tr><td class="line-number" value="160"></td><td class="line-content">	border: 1px solid black;</td></tr><tr><td class="line-number" value="161"></td><td class="line-content">	padding: 5px;</td></tr><tr><td class="line-number" value="162"></td><td class="line-content">	text-align: center;</td></tr><tr><td class="line-number" value="163"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="164"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="165"></td><td class="line-content">.palette {</td></tr><tr><td class="line-number" value="166"></td><td class="line-content">	float: left;</td></tr><tr><td class="line-number" value="167"></td><td class="line-content">	margin-bottom: 5px;</td></tr><tr><td class="line-number" value="168"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="169"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="170"></td><td class="line-content">.pencolor {</td></tr><tr><td class="line-number" value="171"></td><td class="line-content">	width: 80px;</td></tr><tr><td class="line-number" value="172"></td><td class="line-content">	height: 30px;</td></tr><tr><td class="line-number" value="173"></td><td class="line-content">	border: 1px solid black;</td></tr><tr><td class="line-number" value="174"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="175"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="176"></td><td class="line-content">.pencolor-bg {</td></tr><tr><td class="line-number" value="177"></td><td class="line-content">	position: relative;</td></tr><tr><td class="line-number" value="178"></td><td class="line-content">	width: 80px;</td></tr><tr><td class="line-number" value="179"></td><td class="line-content">	height: 30px;</td></tr><tr><td class="line-number" value="180"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="181"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="182"></td><td class="line-content"><span class="html-tag">&lt;/style&gt;</span></td></tr><tr><td class="line-number" value="183"></td><td class="line-content"><span class="html-tag">&lt;/head&gt;</span></td></tr><tr><td class="line-number" value="184"></td><td class="line-content"><span class="html-tag">&lt;body <span class="html-attribute-name">style</span>="<span class="html-attribute-value">background-color: #ccc;</span>"&gt;</span></td></tr><tr><td class="line-number" value="185"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="186"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">settings</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup</span>"&gt;</span></td></tr><tr><td class="line-number" value="187"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">closepopup noselect</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">openPopup('settings',false)</span>"&gt;</span>×<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="188"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-left: 20px; text-align: center; font-style: italic;</span>"</span></td></tr><tr><td class="line-number" value="189"></td><td class="line-content">	&gt;Tiny sprite editor 20160530 by Boris van Schooten.<span class="html-tag">&lt;br&gt;</span></td></tr><tr><td class="line-number" value="190"></td><td class="line-content">	<span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="http://tmtg.net/tinyspriteeditor/">http://tmtg.net/tinyspriteeditor/</a>" <span class="html-attribute-name">target</span>="<span class="html-attribute-value">_blank</span>"&gt;</span>Homepage.<span class="html-tag">&lt;/a&gt;</span></td></tr><tr><td class="line-number" value="191"></td><td class="line-content">	<span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="https://opensource.org/licenses/BSD-3-ClauseRevised">https://opensource.org/licenses/BSD-3-ClauseRevised</a>"</span></td></tr><tr><td class="line-number" value="192"></td><td class="line-content">	<span class="html-attribute-name">target</span>="<span class="html-attribute-value">_blank</span>"&gt;BSD license.<span class="html-tag">&lt;/a&gt;</span></td></tr><tr><td class="line-number" value="193"></td><td class="line-content">	Download me and run locally! </td></tr><tr><td class="line-number" value="194"></td><td class="line-content">	<span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="https://github.com/borisvanschooten/tinyspriteeditor">https://github.com/borisvanschooten/tinyspriteeditor</a>"</span></td></tr><tr><td class="line-number" value="195"></td><td class="line-content">	<span class="html-attribute-name">target</span>="<span class="html-attribute-value">_blank</span>"&gt;Modify me!<span class="html-tag">&lt;/a&gt;</span></td></tr><tr><td class="line-number" value="196"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="197"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-left: 20px; font-weight:bold; font-size:120%;</span>"</span></td></tr><tr><td class="line-number" value="198"></td><td class="line-content">	&gt;Settings<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="199"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="200"></td><td class="line-content">		Tile width: <span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">number</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">cfg_tilex</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">12</span>"&gt;</span></td></tr><tr><td class="line-number" value="201"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="202"></td><td class="line-content">		Tile height: <span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">number</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">cfg_tiley</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">12</span>"&gt;</span></td></tr><tr><td class="line-number" value="203"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="204"></td><td class="line-content">		Nr tiles X: <span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">number</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">cfg_nrtilesx</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">8</span>"&gt;</span></td></tr><tr><td class="line-number" value="205"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="206"></td><td class="line-content">		Nr tiles Y: <span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">number</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">cfg_nrtilesy</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">8</span>"&gt;</span></td></tr><tr><td class="line-number" value="207"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="208"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">configSetSize();openPopup('settings',false);</span>"&gt;</span>Create new canvas<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="209"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="210"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="211"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="212"></td><td class="line-content">		Color for transparent background:</td></tr><tr><td class="line-number" value="213"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">color</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">transparentcolor</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">#444</span>"&gt;</span></td></tr><tr><td class="line-number" value="214"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="215"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">checkbox</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">transparentchecker</span>" <span class="html-attribute-name">checked</span>="<span class="html-attribute-value">checked</span>"&gt;</span> Use checkerboard<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="216"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">configSpriteBG();openPopup('settings',false);</span>"&gt;</span>Set !<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="217"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="218"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="219"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="220"></td><td class="line-content">		Grid: color</td></tr><tr><td class="line-number" value="221"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">color</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">gridcolor</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">#000</span>"&gt;</span></td></tr><tr><td class="line-number" value="222"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="223"></td><td class="line-content">		thickness</td></tr><tr><td class="line-number" value="224"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">number</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">gridthickness</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">1</span>"&gt;</span></td></tr><tr><td class="line-number" value="225"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="226"></td><td class="line-content">		Sprite select box color:</td></tr><tr><td class="line-number" value="227"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">color</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">selectboxcolor</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">#ff0</span>"&gt;</span></td></tr><tr><td class="line-number" value="228"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="229"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">configGrid();openPopup('settings',false);</span>"&gt;</span>Set !<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="230"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="231"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="232"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="233"></td><td class="line-content">		Enlarged image zoom:</td></tr><tr><td class="line-number" value="234"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">number</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">sprzoomlevel</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">4</span>"&gt;</span></td></tr><tr><td class="line-number" value="235"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="236"></td><td class="line-content">		Edit area zoom:</td></tr><tr><td class="line-number" value="237"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">number</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">zoomlevel</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">28</span>"&gt;</span></td></tr><tr><td class="line-number" value="238"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="239"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">configZoom();openPopup('settings',false);</span>"&gt;</span>Set !<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="240"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="241"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="242"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="243"></td><td class="line-content">		Global background color:</td></tr><tr><td class="line-number" value="244"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">color</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">globalbackground</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">#ddd</span>"&gt;</span></td></tr><tr><td class="line-number" value="245"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="246"></td><td class="line-content">		Global foreground color:</td></tr><tr><td class="line-number" value="247"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">color</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">globalforeground</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">#000</span>"&gt;</span></td></tr><tr><td class="line-number" value="248"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="249"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">configGlobal();openPopup('settings',false);</span>"&gt;</span>Set !<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="250"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="251"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="252"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="253"></td><td class="line-content">		Onion skin: transparency:</td></tr><tr><td class="line-number" value="254"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">number</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">onionskinbgtrans</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">1.0</span>"&gt;</span></td></tr><tr><td class="line-number" value="255"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="256"></td><td class="line-content">		size:</td></tr><tr><td class="line-number" value="257"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">number</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">onionskinsize</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">0.33</span>"&gt;</span></td></tr><tr><td class="line-number" value="258"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="259"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">configOnionSkin();openPopup('settings',false);</span>"&gt;</span>Set !<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="260"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="261"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="262"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="263"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="264"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="265"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="266"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">animation</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup</span>"&gt;</span></td></tr><tr><td class="line-number" value="267"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">closepopup noselect</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">openPopup('animation',false)</span>"&gt;</span>×<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="268"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-left: 20px; font-weight:bold; font-size:120%;</span>"</span></td></tr><tr><td class="line-number" value="269"></td><td class="line-content">	&gt;Animation Settings<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="270"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="271"></td><td class="line-content">		<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-top: 10px;</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="272"></td><td class="line-content">		Delay (milliseconds):</td></tr><tr><td class="line-number" value="273"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">class</span>="<span class="html-attribute-value">color</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">animdelay</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">value</span>="<span class="html-attribute-value">200</span>"&gt;</span></td></tr><tr><td class="line-number" value="274"></td><td class="line-content">		<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="275"></td><td class="line-content">		<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-top: 10px;</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="276"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">checkbox</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">animpingpong</span>"&gt;</span><span class="html-tag">&lt;/input&gt;</span> Ping-pong animation</td></tr><tr><td class="line-number" value="277"></td><td class="line-content">		<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-top: 10px; text-align:center;</span>"&gt;</span></td></tr><tr><td class="line-number" value="278"></td><td class="line-content">			<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">configAnim();openPopup('settings',false);</span>"&gt;</span>Set !</td></tr><tr><td class="line-number" value="279"></td><td class="line-content">			<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="280"></td><td class="line-content">		<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="281"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="282"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="283"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="284"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="285"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">sprite</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">float:left;</span>"&gt;</span></td></tr><tr><td class="line-number" value="286"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">tileselect</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">position: relative; width:0px; height:0px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="287"></td><td class="line-content">		<span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">tileselectbox</span>"</span></td></tr><tr><td class="line-number" value="288"></td><td class="line-content">		<span class="html-attribute-name">style</span>="<span class="html-attribute-value">position:relative; width:8px; height:8px; border: 1px solid green;</span>"</td></tr><tr><td class="line-number" value="289"></td><td class="line-content">		&gt;<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="290"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="291"></td><td class="line-content">	<span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">sprite</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">sprite-bg</span>" <span class="html-attribute-name">width</span>=<span class="html-attribute-value">40</span> <span class="html-attribute-name">height</span>=<span class="html-attribute-value">40</span> <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border: 1px solid black;</span>"&gt;</span></td></tr><tr><td class="line-number" value="292"></td><td class="line-content">	<span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="293"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="294"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">tilepreview</span>"&gt;</span></td></tr><tr><td class="line-number" value="295"></td><td class="line-content">	<span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">tilepreview</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">sprite-bg</span>" <span class="html-attribute-name">width</span>=<span class="html-attribute-value">36</span> <span class="html-attribute-name">height</span>=<span class="html-attribute-value">36</span> <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border: 1px solid black;</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="296"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding: 5px;</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="297"></td><td class="line-content">	<span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">tilepreview_l</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">sprite-bg</span>" <span class="html-attribute-name">width</span>=<span class="html-attribute-value">36</span> <span class="html-attribute-name">height</span>=<span class="html-attribute-value">36</span> <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border: 1px solid black;</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="298"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding: 5px;</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="299"></td><td class="line-content">	Tiling preview</td></tr><tr><td class="line-number" value="300"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="301"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="302"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">animpreview</span>"&gt;</span></td></tr><tr><td class="line-number" value="303"></td><td class="line-content">	<span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">animpreview</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">sprite-bg</span>" <span class="html-attribute-name">width</span>=<span class="html-attribute-value">12</span> <span class="html-attribute-name">height</span>=<span class="html-attribute-value">12</span> <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border: 1px solid black;</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="304"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding: 5px;</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="305"></td><td class="line-content">	<span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">animpreview_l</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">sprite-bg</span>" <span class="html-attribute-name">width</span>=<span class="html-attribute-value">36</span> <span class="html-attribute-name">height</span>=<span class="html-attribute-value">36</span> <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border: 1px solid black;</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="306"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding: 5px;</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="307"></td><td class="line-content">	Animation</td></tr><tr><td class="line-number" value="308"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-top: 5px;</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="309"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">id</span>="<span class="html-attribute-value">animtoggle</span>" </span></td></tr><tr><td class="line-number" value="310"></td><td class="line-content">	<span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-left: 0px; padding-right:0px; width: 55px;</span>"</td></tr><tr><td class="line-number" value="311"></td><td class="line-content">	 <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">toggleAnimation()</span>"&gt;Play<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="312"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">openPopup('animation',true);</span>"&gt;</span>⚙ Settings<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="313"></td><td class="line-content">	<span class="html-tag">&lt;div&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="314"></td><td class="line-content">	Set</td></tr><tr><td class="line-number" value="315"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-left: 0px; padding-right:0px;</span>"</span></td></tr><tr><td class="line-number" value="316"></td><td class="line-content">	 <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">setAnimFrame('start')</span>"&gt;Start<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="317"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-left: 0px; padding-right:0px;</span>"</span></td></tr><tr><td class="line-number" value="318"></td><td class="line-content">	 <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">setAnimFrame('end')</span>"&gt;End<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="319"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="320"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="321"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="322"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="323"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">spritezoom</span>"&gt;</span></td></tr><tr><td class="line-number" value="324"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">tileselect_l</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">position: relative; width:0px; height:0px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="325"></td><td class="line-content">		<span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">tileselect_lbox</span>"</span></td></tr><tr><td class="line-number" value="326"></td><td class="line-content">		<span class="html-attribute-name">style</span>="<span class="html-attribute-value">position:relative; width:8px; height:8px; border: 1px solid green;</span>"</td></tr><tr><td class="line-number" value="327"></td><td class="line-content">		&gt;<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="328"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="329"></td><td class="line-content">	<span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">sprite_l</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">sprite-bg</span>" <span class="html-attribute-name">width</span>=<span class="html-attribute-value">40</span> <span class="html-attribute-name">height</span>=<span class="html-attribute-value">40</span> <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border: 1px solid black;</span>"&gt;</span></td></tr><tr><td class="line-number" value="330"></td><td class="line-content">	<span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="331"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="332"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="333"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">zoomcontainer</span>"&gt;</span></td></tr><tr><td class="line-number" value="334"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">float:right;</span>"&gt;</span></td></tr><tr><td class="line-number" value="335"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left: 15px;</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">retrieveHistory(false)</span>"&gt;</span>Undo<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="336"></td><td class="line-content">		<span class="html-tag">&lt;div&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="337"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left: 15px;</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">retrieveHistory(true)</span>"&gt;</span>Redo<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="338"></td><td class="line-content">		<span class="html-tag">&lt;div&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="339"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left: 15px;</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">cutSprite()</span>"&gt;</span>Cut<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="340"></td><td class="line-content">		<span class="html-tag">&lt;div&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="341"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left: 15px;</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">copySprite()</span>"&gt;</span>Copy<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="342"></td><td class="line-content">		<span class="html-tag">&lt;div&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="343"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left: 15px;</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">pasteSprite()</span>"&gt;</span>Paste<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="344"></td><td class="line-content">		<span class="html-tag">&lt;div&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="345"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left: 15px;</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">mergeSprite()</span>"&gt;</span>Merge<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="346"></td><td class="line-content">		<span class="html-tag">&lt;div&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="347"></td><td class="line-content">		<span class="html-tag">&lt;input <span class="html-attribute-name">id</span>="<span class="html-attribute-value">setonionskin</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">checkbox</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left: 15px;</span>" <span class="html-attribute-name">onchange</span>="<span class="html-attribute-value">setOnionSkin()</span>"&gt;</span>Onion Skin<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="348"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="349"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">zoom</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">float:left;</span>"&gt;</span></td></tr><tr><td class="line-number" value="350"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="351"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">clear:both; padding-bottom: 35px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="352"></td><td class="line-content">		<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">position:relative; height: 0px; top:5px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="353"></td><td class="line-content">			name: <span class="html-tag">&lt;input <span class="html-attribute-name">id</span>="<span class="html-attribute-value">spritenameline</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>"</span></td></tr><tr><td class="line-number" value="354"></td><td class="line-content">			 <span class="html-attribute-name">style</span>="<span class="html-attribute-value">background-color: transparent;</span>"</td></tr><tr><td class="line-number" value="355"></td><td class="line-content">			 <span class="html-attribute-name">onchange</span>="<span class="html-attribute-value">storeSpriteNameLine()</span>"&gt;<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="356"></td><td class="line-content">		<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="357"></td><td class="line-content">		<span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">commandline</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">commandline</span>"&gt;</span></td></tr><tr><td class="line-number" value="358"></td><td class="line-content">			<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">commandline-bubble</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="359"></td><td class="line-content">			<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">closecommand noselect</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">closeCommand()</span>"&gt;</span>×<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="360"></td><td class="line-content">			<span class="html-tag">&lt;span <span class="html-attribute-name">id</span>="<span class="html-attribute-value">commandline-text</span>"&gt;</span><span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="361"></td><td class="line-content">		<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="362"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="363"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">palette</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">palette</span>"&gt;</span></td></tr><tr><td class="line-number" value="364"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="365"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">float:left; margin-left: 10px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="366"></td><td class="line-content">		<span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">pencolor</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">pencolor</span>"&gt;</span></td></tr><tr><td class="line-number" value="367"></td><td class="line-content">			<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">position: relative; width:0px; height:0px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="368"></td><td class="line-content">				<span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">pencolor-bg</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">pencolor-bg sprite-bg</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="369"></td><td class="line-content">			<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="370"></td><td class="line-content">		<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="371"></td><td class="line-content">		<span class="html-tag">&lt;div&gt;</span></td></tr><tr><td class="line-number" value="372"></td><td class="line-content">			<span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">textfield</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">color</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">pencolor-text</span>"</span></td></tr><tr><td class="line-number" value="373"></td><td class="line-content">			 <span class="html-attribute-name">onchange</span>="<span class="html-attribute-value">setPenColorFromText();</span>"&gt;<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="374"></td><td class="line-content">		<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="375"></td><td class="line-content">		<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">startCommand('PickPenColor');</span>"&gt;</span>Pick color<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="376"></td><td class="line-content">		<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">padding-bottom: 5px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="377"></td><td class="line-content">			Palette:<span class="html-tag">&lt;br&gt;</span></td></tr><tr><td class="line-number" value="378"></td><td class="line-content">			<span class="html-tag">&lt;select <span class="html-attribute-name">id</span>="<span class="html-attribute-value">palettename</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:100%;</span>" <span class="html-attribute-name">onchange</span>="<span class="html-attribute-value">setPalette(this)</span>"&gt;</span></td></tr><tr><td class="line-number" value="379"></td><td class="line-content">				<span class="html-tag">&lt;option <span class="html-attribute-name">value</span>="<span class="html-attribute-value">Standard</span>"&gt;</span>Standard<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="380"></td><td class="line-content">				<span class="html-tag">&lt;option <span class="html-attribute-name">value</span>="<span class="html-attribute-value">NES</span>"&gt;</span>NES 8bit<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="381"></td><td class="line-content">				<span class="html-tag">&lt;option <span class="html-attribute-name">value</span>="<span class="html-attribute-value">Comic</span>"&gt;</span>Comic<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="382"></td><td class="line-content">				<span class="html-tag">&lt;option <span class="html-attribute-name">value</span>="<span class="html-attribute-value">Pico8</span>"&gt;</span>Pico 8<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="383"></td><td class="line-content">				<span class="html-tag">&lt;option <span class="html-attribute-name">value</span>="<span class="html-attribute-value">CBM64</span>"&gt;</span>CBM 64<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="384"></td><td class="line-content">				<span class="html-tag">&lt;option <span class="html-attribute-name">value</span>="<span class="html-attribute-value">Puzzlescript</span>"&gt;</span>puzzlescript<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="385"></td><td class="line-content">			<span class="html-tag">&lt;/select&gt;</span></td></tr><tr><td class="line-number" value="386"></td><td class="line-content">		<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="387"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="388"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="389"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="390"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="391"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="392"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="393"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="394"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="395"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="396"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">clear:both</span>" &gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="397"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="398"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">buttoncontainer</span>"&gt;</span></td></tr><tr><td class="line-number" value="399"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">openPopup('settings',true)</span>"</span></td></tr><tr><td class="line-number" value="400"></td><td class="line-content">	 <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top: 10px; margin-right: 10px; font-size:160%; background-color: #f88; float:left;</span>"&gt;⚙ Settings<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="401"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">createOutline()</span>"&gt;</span>Outline<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="402"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">startCommand('ReplaceColor')</span>"&gt;</span>Replace color<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="403"></td><td class="line-content">	Delete: </td></tr><tr><td class="line-number" value="404"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">startCommand('DelRow')</span>"&gt;</span>row<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="405"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">startCommand('DelColumn')</span>"&gt;</span>column<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="406"></td><td class="line-content">	Insert: </td></tr><tr><td class="line-number" value="407"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">startCommand('InsRow')</span>"&gt;</span>row<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="408"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">startCommand('InsColumn')</span>"&gt;</span>column<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="409"></td><td class="line-content">	Rorschach:</td></tr><tr><td class="line-number" value="410"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">copyMirrorX()</span>"&gt;</span>X<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="411"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">copyMirrorY()</span>"&gt;</span>Y<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="412"></td><td class="line-content">	<span class="html-tag">&lt;div&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="413"></td><td class="line-content">	Flood fill:</td></tr><tr><td class="line-number" value="414"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">startCommand('FloodFill4')</span>"&gt;</span>4-way<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="415"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">startCommand('FloodFill8')</span>"&gt;</span>8-way<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="416"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">shiftSprite(-1,0)</span>"&gt;</span>⇐<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="417"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">shiftSprite(1,0)</span>"&gt;</span>⇒<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="418"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">shiftSprite(0,-1)</span>"&gt;</span>⇑<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="419"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">shiftSprite(0,1)</span>"&gt;</span>⇓<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="420"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">flipSprite(false)</span>"&gt;</span>↔<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="421"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">flipSprite(true)</span>"&gt;</span>↕<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="422"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">rotSprite(1)</span>"&gt;</span>↻<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="423"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">rotSprite(-1)</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-right: 30px;</span>"&gt;</span>↺<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="424"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="425"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="426"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">clear:both;</span>" &gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="427"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="428"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">float:left; margin-top:10px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="429"></td><td class="line-content">	With</td></tr><tr><td class="line-number" value="430"></td><td class="line-content">	<span class="html-tag">&lt;select <span class="html-attribute-name">id</span>="<span class="html-attribute-value">imgloadsavetarget</span>"&gt;</span></td></tr><tr><td class="line-number" value="431"></td><td class="line-content">	<span class="html-tag">&lt;option <span class="html-attribute-name">value</span>="<span class="html-attribute-value">all</span>"&gt;</span>whole image<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="432"></td><td class="line-content">	<span class="html-tag">&lt;option <span class="html-attribute-name">value</span>="<span class="html-attribute-value">sprite</span>"&gt;</span>current sprite<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="433"></td><td class="line-content">	<span class="html-tag">&lt;/select&gt;</span>:</td></tr><tr><td class="line-number" value="434"></td><td class="line-content">	<span class="html-tag">&lt;a <span class="html-attribute-name">download</span>="<span class="html-attribute-value">image.png</span>" <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="http://tmtg.net/tinyspriteeditor/tinyspriteeditor.html#">#</a>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">return savePNG(this)</span>"</span></td></tr><tr><td class="line-number" value="435"></td><td class="line-content">	&gt;<span class="html-tag">&lt;button&gt;</span>Save PNG<span class="html-tag">&lt;/button&gt;</span><span class="html-tag">&lt;/a&gt;</span></td></tr><tr><td class="line-number" value="436"></td><td class="line-content">	<span class="html-tag">&lt;label <span class="html-attribute-name">for</span>="<span class="html-attribute-value">pngfile</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">anchorbutton</span>"&gt;</span>Load Image<span class="html-tag">&lt;/label&gt;</span></td></tr><tr><td class="line-number" value="437"></td><td class="line-content">	<span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">file</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">pngfile</span>" <span class="html-attribute-name">onchange</span>="<span class="html-attribute-value">loadPNG(this.files)</span>"</span></td></tr><tr><td class="line-number" value="438"></td><td class="line-content">	<span class="html-attribute-name">accept</span>="<span class="html-attribute-value">image/*</span>"&gt;<span class="html-tag">&lt;/input&gt;</span></td></tr><tr><td class="line-number" value="439"></td><td class="line-content">	Text format:</td></tr><tr><td class="line-number" value="440"></td><td class="line-content">	<span class="html-tag">&lt;select <span class="html-attribute-name">id</span>="<span class="html-attribute-value">textfiletype</span>"&gt;</span></td></tr><tr><td class="line-number" value="441"></td><td class="line-content">	<span class="html-tag">&lt;option <span class="html-attribute-name">name</span>="<span class="html-attribute-value">DataURL</span>"&gt;</span>Data URL<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="442"></td><td class="line-content">	<span class="html-tag">&lt;option <span class="html-attribute-name">name</span>="<span class="html-attribute-value">CellScript</span>"&gt;</span>CellScript<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="443"></td><td class="line-content">	<span class="html-tag">&lt;option <span class="html-attribute-name">name</span>="<span class="html-attribute-value">Puzzlescript</span>"&gt;</span>Puzzlescript<span class="html-tag">&lt;/option&gt;</span></td></tr><tr><td class="line-number" value="444"></td><td class="line-content">	<span class="html-tag">&lt;/select&gt;</span></td></tr><tr><td class="line-number" value="445"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">importImage()</span>"&gt;</span>Import<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="446"></td><td class="line-content">	<span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">exportImage()</span>"&gt;</span>Export<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="447"></td><td class="line-content">	<span class="html-tag">&lt;div&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="448"></td><td class="line-content">	<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width:220px; float:left; padding-top:10px; text-align:right;</span></span></td></tr><tr><td class="line-number" value="449"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">	padding-right: 10px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="450"></td><td class="line-content">	Click in textarea to select its contents.</td></tr><tr><td class="line-number" value="451"></td><td class="line-content">	<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="452"></td><td class="line-content">	<span class="html-tag">&lt;textarea <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width: 400px; height:50px; vertical-align: top;</span></span></td></tr><tr><td class="line-number" value="453"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">	font-size: 60%;</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">dataurl</span>" </span></td></tr><tr><td class="line-number" value="454"></td><td class="line-content">		<span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">this.focus(); this.select();</span>"&gt;</td></tr><tr><td class="line-number" value="455"></td><td class="line-content">	<span class="html-tag">&lt;/textarea&gt;</span></td></tr><tr><td class="line-number" value="456"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="457"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="458"></td><td class="line-content"><span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="459"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="460"></td><td class="line-content">var spritecanvas = document.getElementById("sprite");</td></tr><tr><td class="line-number" value="461"></td><td class="line-content">var spritecanvaszoom = document.getElementById("sprite_l");</td></tr><tr><td class="line-number" value="462"></td><td class="line-content">var zoom = document.getElementById("zoom");</td></tr><tr><td class="line-number" value="463"></td><td class="line-content">var palette = document.getElementById("palette");</td></tr><tr><td class="line-number" value="464"></td><td class="line-content">var dataurl = document.getElementById("dataurl");</td></tr><tr><td class="line-number" value="465"></td><td class="line-content">var spritenameline = document.getElementById("spritenameline");</td></tr><tr><td class="line-number" value="466"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="467"></td><td class="line-content">var undohistory;</td></tr><tr><td class="line-number" value="468"></td><td class="line-content">var cutbuffer, opbuffer;</td></tr><tr><td class="line-number" value="469"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="470"></td><td class="line-content">var nrPixelsBeforeAutosave=0;</td></tr><tr><td class="line-number" value="471"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="472"></td><td class="line-content">var tilex = 12;</td></tr><tr><td class="line-number" value="473"></td><td class="line-content">var tiley = 12;</td></tr><tr><td class="line-number" value="474"></td><td class="line-content">var nrtilesx = 8;</td></tr><tr><td class="line-number" value="475"></td><td class="line-content">var nrtilesy = 8;</td></tr><tr><td class="line-number" value="476"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="477"></td><td class="line-content">var curtilex = 0;</td></tr><tr><td class="line-number" value="478"></td><td class="line-content">var curtiley = 0;</td></tr><tr><td class="line-number" value="479"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="480"></td><td class="line-content">var sprzoomlevel=4;</td></tr><tr><td class="line-number" value="481"></td><td class="line-content">var zoomlevel=28;</td></tr><tr><td class="line-number" value="482"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="483"></td><td class="line-content">var pencolor = [255,255,255,255];</td></tr><tr><td class="line-number" value="484"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="485"></td><td class="line-content">var prevclick = {x:-1,y:-1};</td></tr><tr><td class="line-number" value="486"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="487"></td><td class="line-content">var gridcolor = "#000";</td></tr><tr><td class="line-number" value="488"></td><td class="line-content">var gridthickness = 1;</td></tr><tr><td class="line-number" value="489"></td><td class="line-content">var selectboxcolor = "#0f0";</td></tr><tr><td class="line-number" value="490"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="491"></td><td class="line-content">var spritebgcolor = "#444";</td></tr><tr><td class="line-number" value="492"></td><td class="line-content">var spritebgchecker = true;</td></tr><tr><td class="line-number" value="493"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="494"></td><td class="line-content">var onionskin = {</td></tr><tr><td class="line-number" value="495"></td><td class="line-content">	src: null,</td></tr><tr><td class="line-number" value="496"></td><td class="line-content">	fgTrans: 1.0, // currently not configurable</td></tr><tr><td class="line-number" value="497"></td><td class="line-content">	bgTrans: 1.0,</td></tr><tr><td class="line-number" value="498"></td><td class="line-content">	size: 0.33,</td></tr><tr><td class="line-number" value="499"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="500"></td><td class="line-content">document.getElementById("setonionskin").checked = false;</td></tr><tr><td class="line-number" value="501"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="502"></td><td class="line-content">var anim = {</td></tr><tr><td class="line-number" value="503"></td><td class="line-content">	delay: 200,</td></tr><tr><td class="line-number" value="504"></td><td class="line-content">	startframe: {x:0, y:0},</td></tr><tr><td class="line-number" value="505"></td><td class="line-content">	endframe: {x:3, y:0},</td></tr><tr><td class="line-number" value="506"></td><td class="line-content">	pingpong: false,</td></tr><tr><td class="line-number" value="507"></td><td class="line-content">	currentframe: 0,</td></tr><tr><td class="line-number" value="508"></td><td class="line-content">	direction: 1,</td></tr><tr><td class="line-number" value="509"></td><td class="line-content">	timer: null, // null indicates not running</td></tr><tr><td class="line-number" value="510"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="511"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="512"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="513"></td><td class="line-content">var palettes = {</td></tr><tr><td class="line-number" value="514"></td><td class="line-content">"Standard": [</td></tr><tr><td class="line-number" value="515"></td><td class="line-content">	[  0,   0,   0,   0],</td></tr><tr><td class="line-number" value="516"></td><td class="line-content">	[110,  70,  70, 255],</td></tr><tr><td class="line-number" value="517"></td><td class="line-content">	[130,  80,  70, 255],</td></tr><tr><td class="line-number" value="518"></td><td class="line-content">	[120,  90,  80, 255],</td></tr><tr><td class="line-number" value="519"></td><td class="line-content">	[100, 110,  60, 255],</td></tr><tr><td class="line-number" value="520"></td><td class="line-content">	[ 80, 110,  80, 255],</td></tr><tr><td class="line-number" value="521"></td><td class="line-content">	[ 80, 120, 120, 255],</td></tr><tr><td class="line-number" value="522"></td><td class="line-content">	[ 80,  80, 120, 255],</td></tr><tr><td class="line-number" value="523"></td><td class="line-content">	[110,  80, 130, 255],</td></tr><tr><td class="line-number" value="524"></td><td class="line-content">	[130,  80, 130, 255],</td></tr><tr><td class="line-number" value="525"></td><td class="line-content">	[120,  80, 100, 255],</td></tr><tr><td class="line-number" value="526"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="527"></td><td class="line-content">	[  0,   0,   0, 255],</td></tr><tr><td class="line-number" value="528"></td><td class="line-content">	[180, 120, 120, 255],</td></tr><tr><td class="line-number" value="529"></td><td class="line-content">	[200, 140, 110, 255],</td></tr><tr><td class="line-number" value="530"></td><td class="line-content">	[190, 160, 120, 255],</td></tr><tr><td class="line-number" value="531"></td><td class="line-content">	[150, 190, 110, 255],</td></tr><tr><td class="line-number" value="532"></td><td class="line-content">	[120, 170, 120, 255],</td></tr><tr><td class="line-number" value="533"></td><td class="line-content">	[120, 180, 180, 255],</td></tr><tr><td class="line-number" value="534"></td><td class="line-content">	[140, 140, 190, 255],</td></tr><tr><td class="line-number" value="535"></td><td class="line-content">	[165, 120, 210, 255],</td></tr><tr><td class="line-number" value="536"></td><td class="line-content">	[180, 120, 180, 255],</td></tr><tr><td class="line-number" value="537"></td><td class="line-content">	[210, 120, 155, 255],</td></tr><tr><td class="line-number" value="538"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="539"></td><td class="line-content">	[255, 255, 255, 255],</td></tr><tr><td class="line-number" value="540"></td><td class="line-content">	[255, 190, 190, 255],</td></tr><tr><td class="line-number" value="541"></td><td class="line-content">	[255, 210,  64, 255],</td></tr><tr><td class="line-number" value="542"></td><td class="line-content">	[255, 255, 140, 255],</td></tr><tr><td class="line-number" value="543"></td><td class="line-content">	[220, 255, 100, 255],</td></tr><tr><td class="line-number" value="544"></td><td class="line-content">	[160, 255, 160, 255],</td></tr><tr><td class="line-number" value="545"></td><td class="line-content">	[170, 255, 225, 255],</td></tr><tr><td class="line-number" value="546"></td><td class="line-content">	[180, 180, 255, 255],</td></tr><tr><td class="line-number" value="547"></td><td class="line-content">	[225, 170, 255, 255],</td></tr><tr><td class="line-number" value="548"></td><td class="line-content">	[255, 160, 255, 255],</td></tr><tr><td class="line-number" value="549"></td><td class="line-content">	[255, 160, 185, 255],</td></tr><tr><td class="line-number" value="550"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="551"></td><td class="line-content">	// primary colours</td></tr><tr><td class="line-number" value="552"></td><td class="line-content">	[192, 192, 192, 255],</td></tr><tr><td class="line-number" value="553"></td><td class="line-content">	[255, 100, 100, 255],</td></tr><tr><td class="line-number" value="554"></td><td class="line-content">	[255, 150,   0, 255],</td></tr><tr><td class="line-number" value="555"></td><td class="line-content">	[255, 255,   0, 255],</td></tr><tr><td class="line-number" value="556"></td><td class="line-content">	[180, 255,   0, 255],</td></tr><tr><td class="line-number" value="557"></td><td class="line-content">	[  0, 255,   0, 255],</td></tr><tr><td class="line-number" value="558"></td><td class="line-content">	[  0, 255, 255, 255],</td></tr><tr><td class="line-number" value="559"></td><td class="line-content">	[100, 100, 255, 255],</td></tr><tr><td class="line-number" value="560"></td><td class="line-content">	[180,   0, 255, 255],</td></tr><tr><td class="line-number" value="561"></td><td class="line-content">	[255,   0, 255, 255],</td></tr><tr><td class="line-number" value="562"></td><td class="line-content">	[255,   0, 140, 255],</td></tr><tr><td class="line-number" value="563"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="564"></td><td class="line-content">	[128, 128, 128, 255],</td></tr><tr><td class="line-number" value="565"></td><td class="line-content">	[255,   0,   0, 255],</td></tr><tr><td class="line-number" value="566"></td><td class="line-content">	[210,  70,   0, 255],</td></tr><tr><td class="line-number" value="567"></td><td class="line-content">	[180, 135,   0, 255],</td></tr><tr><td class="line-number" value="568"></td><td class="line-content">	[130, 190,   0, 255],</td></tr><tr><td class="line-number" value="569"></td><td class="line-content">	[  0, 170,   0, 255],</td></tr><tr><td class="line-number" value="570"></td><td class="line-content">	[  0, 140, 170, 255],</td></tr><tr><td class="line-number" value="571"></td><td class="line-content">	[  0,   0, 255, 255],</td></tr><tr><td class="line-number" value="572"></td><td class="line-content">	[120,   0, 170, 255],</td></tr><tr><td class="line-number" value="573"></td><td class="line-content">	[170,   0, 170, 255],</td></tr><tr><td class="line-number" value="574"></td><td class="line-content">	[180,   0, 130, 255],</td></tr><tr><td class="line-number" value="575"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="576"></td><td class="line-content">	[ 64,  64,  64, 255],</td></tr><tr><td class="line-number" value="577"></td><td class="line-content">	[120,   0,   0, 255],</td></tr><tr><td class="line-number" value="578"></td><td class="line-content">	[145,  40,   0, 255],</td></tr><tr><td class="line-number" value="579"></td><td class="line-content">	[115,  75,   0, 255],</td></tr><tr><td class="line-number" value="580"></td><td class="line-content">	[ 60, 120,   0, 255],</td></tr><tr><td class="line-number" value="581"></td><td class="line-content">	[  0,  96,   0, 255],</td></tr><tr><td class="line-number" value="582"></td><td class="line-content">	[  0,  80, 105, 255],</td></tr><tr><td class="line-number" value="583"></td><td class="line-content">	[  0,   0, 130, 255],</td></tr><tr><td class="line-number" value="584"></td><td class="line-content">	[ 65,   0, 105, 255],</td></tr><tr><td class="line-number" value="585"></td><td class="line-content">	[ 95,   0,  95, 255],</td></tr><tr><td class="line-number" value="586"></td><td class="line-content">	[125,   0,  65, 255],</td></tr><tr><td class="line-number" value="587"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="588"></td><td class="line-content">], "Pico8": [</td></tr><tr><td class="line-number" value="589"></td><td class="line-content">	[  0,   0,   0, 255],</td></tr><tr><td class="line-number" value="590"></td><td class="line-content">	[ 32,  51, 123, 255],</td></tr><tr><td class="line-number" value="591"></td><td class="line-content">	[126,  37,  83, 255],</td></tr><tr><td class="line-number" value="592"></td><td class="line-content">	[  0, 144,  61, 255],</td></tr><tr><td class="line-number" value="593"></td><td class="line-content">	[171,  82,  54, 255],</td></tr><tr><td class="line-number" value="594"></td><td class="line-content">	[ 52,  54,  53, 255],</td></tr><tr><td class="line-number" value="595"></td><td class="line-content">	[194, 195, 199, 255],</td></tr><tr><td class="line-number" value="596"></td><td class="line-content">	[255, 241, 232, 255],</td></tr><tr><td class="line-number" value="597"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="598"></td><td class="line-content">	[255,   0,  77, 255],</td></tr><tr><td class="line-number" value="599"></td><td class="line-content">	[255, 155,   0, 255],</td></tr><tr><td class="line-number" value="600"></td><td class="line-content">	[255, 231,  39, 255],</td></tr><tr><td class="line-number" value="601"></td><td class="line-content">	[  0, 226,  50, 255],</td></tr><tr><td class="line-number" value="602"></td><td class="line-content">	[ 41, 173, 255, 255],</td></tr><tr><td class="line-number" value="603"></td><td class="line-content">	[132, 112, 169, 255],</td></tr><tr><td class="line-number" value="604"></td><td class="line-content">	[255, 119, 168, 255],</td></tr><tr><td class="line-number" value="605"></td><td class="line-content">	[255, 214, 197, 255],</td></tr><tr><td class="line-number" value="606"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="607"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="608"></td><td class="line-content">], "NES": [</td></tr><tr><td class="line-number" value="609"></td><td class="line-content">	[124,124,124, 255],</td></tr><tr><td class="line-number" value="610"></td><td class="line-content">	[0,0,252, 255],</td></tr><tr><td class="line-number" value="611"></td><td class="line-content">	[0,0,188, 255],</td></tr><tr><td class="line-number" value="612"></td><td class="line-content">	[68,40,188, 255],</td></tr><tr><td class="line-number" value="613"></td><td class="line-content">	[148,0,132, 255],</td></tr><tr><td class="line-number" value="614"></td><td class="line-content">	[168,0,32, 255],</td></tr><tr><td class="line-number" value="615"></td><td class="line-content">	[168,16,0, 255],</td></tr><tr><td class="line-number" value="616"></td><td class="line-content">	[136,20,0, 255],</td></tr><tr><td class="line-number" value="617"></td><td class="line-content">	[80,48,0, 255],</td></tr><tr><td class="line-number" value="618"></td><td class="line-content">	[0,120,0, 255],</td></tr><tr><td class="line-number" value="619"></td><td class="line-content">	[0,104,0, 255],</td></tr><tr><td class="line-number" value="620"></td><td class="line-content">	[0,88,0, 255],</td></tr><tr><td class="line-number" value="621"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="622"></td><td class="line-content">	[188,188,188, 255],</td></tr><tr><td class="line-number" value="623"></td><td class="line-content">	[0,120,248, 255],</td></tr><tr><td class="line-number" value="624"></td><td class="line-content">	[0,88,248, 255],</td></tr><tr><td class="line-number" value="625"></td><td class="line-content">	[104,68,252, 255],</td></tr><tr><td class="line-number" value="626"></td><td class="line-content">	[216,0,204, 255],</td></tr><tr><td class="line-number" value="627"></td><td class="line-content">	[228,0,88, 255],</td></tr><tr><td class="line-number" value="628"></td><td class="line-content">	[248,56,0, 255],</td></tr><tr><td class="line-number" value="629"></td><td class="line-content">	[228,92,16, 255],</td></tr><tr><td class="line-number" value="630"></td><td class="line-content">	[172,124,0, 255],</td></tr><tr><td class="line-number" value="631"></td><td class="line-content">	[0,184,0, 255],</td></tr><tr><td class="line-number" value="632"></td><td class="line-content">	[0,168,0, 255],</td></tr><tr><td class="line-number" value="633"></td><td class="line-content">	[0,168,68, 255],</td></tr><tr><td class="line-number" value="634"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="635"></td><td class="line-content">	[248,248,248, 255],</td></tr><tr><td class="line-number" value="636"></td><td class="line-content">	[60,188,252, 255],</td></tr><tr><td class="line-number" value="637"></td><td class="line-content">	[104,136,252, 255],</td></tr><tr><td class="line-number" value="638"></td><td class="line-content">	[152,120,248, 255],</td></tr><tr><td class="line-number" value="639"></td><td class="line-content">	[248,120,248, 255],</td></tr><tr><td class="line-number" value="640"></td><td class="line-content">	[248,88,152, 255],</td></tr><tr><td class="line-number" value="641"></td><td class="line-content">	[248,120,88, 255],</td></tr><tr><td class="line-number" value="642"></td><td class="line-content">	[252,160,68, 255],</td></tr><tr><td class="line-number" value="643"></td><td class="line-content">	[248,184,0, 255],</td></tr><tr><td class="line-number" value="644"></td><td class="line-content">	[184,248,24, 255],</td></tr><tr><td class="line-number" value="645"></td><td class="line-content">	[88,216,84, 255],</td></tr><tr><td class="line-number" value="646"></td><td class="line-content">	[88,248,152, 255],</td></tr><tr><td class="line-number" value="647"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="648"></td><td class="line-content">	[252,252,252, 255],</td></tr><tr><td class="line-number" value="649"></td><td class="line-content">	[164,228,252, 255],</td></tr><tr><td class="line-number" value="650"></td><td class="line-content">	[184,184,248, 255],</td></tr><tr><td class="line-number" value="651"></td><td class="line-content">	[216,184,248, 255],</td></tr><tr><td class="line-number" value="652"></td><td class="line-content">	[248,184,248, 255],</td></tr><tr><td class="line-number" value="653"></td><td class="line-content">	[248,164,192, 255],</td></tr><tr><td class="line-number" value="654"></td><td class="line-content">	[240,208,176, 255],</td></tr><tr><td class="line-number" value="655"></td><td class="line-content">	[252,224,168, 255],</td></tr><tr><td class="line-number" value="656"></td><td class="line-content">	[248,216,120, 255],</td></tr><tr><td class="line-number" value="657"></td><td class="line-content">	[216,248,120, 255],</td></tr><tr><td class="line-number" value="658"></td><td class="line-content">	[184,248,184, 255],</td></tr><tr><td class="line-number" value="659"></td><td class="line-content">	[184,248,216, 255],</td></tr><tr><td class="line-number" value="660"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="661"></td><td class="line-content">	[0,252,252, 255],</td></tr><tr><td class="line-number" value="662"></td><td class="line-content">	[0,232,216, 255],</td></tr><tr><td class="line-number" value="663"></td><td class="line-content">	[0,136,136, 255],</td></tr><tr><td class="line-number" value="664"></td><td class="line-content">	[0,64,88, 255],</td></tr><tr><td class="line-number" value="665"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="666"></td><td class="line-content">	[248,216,248, 255],</td></tr><tr><td class="line-number" value="667"></td><td class="line-content">	[120,120,120, 255],</td></tr><tr><td class="line-number" value="668"></td><td class="line-content">	[0,0,0, 255],</td></tr><tr><td class="line-number" value="669"></td><td class="line-content">	[0,0,0, 0],</td></tr><tr><td class="line-number" value="670"></td><td class="line-content">], "Comic": [ </td></tr><tr><td class="line-number" value="671"></td><td class="line-content">//http://kirbymuseum.org/blogs/simonandkirby/archives/tag/comic-book-colorists</td></tr><tr><td class="line-number" value="672"></td><td class="line-content">	[  0,170,239,255],</td></tr><tr><td class="line-number" value="673"></td><td class="line-content">	[101,209,244,255],</td></tr><tr><td class="line-number" value="674"></td><td class="line-content">	[193,232,252,255],</td></tr><tr><td class="line-number" value="675"></td><td class="line-content">	[  0,105,184,255],</td></tr><tr><td class="line-number" value="676"></td><td class="line-content">	[  0,139,214,255],</td></tr><tr><td class="line-number" value="677"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="678"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="679"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="680"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="681"></td><td class="line-content">	[255,  0,127,255],</td></tr><tr><td class="line-number" value="682"></td><td class="line-content">	[255,158,189,255],</td></tr><tr><td class="line-number" value="683"></td><td class="line-content">	[255,208,228,255],</td></tr><tr><td class="line-number" value="684"></td><td class="line-content">	[255,  0, 31,255],</td></tr><tr><td class="line-number" value="685"></td><td class="line-content">	[255,156,  0,255],</td></tr><tr><td class="line-number" value="686"></td><td class="line-content">	[255,198,  0,255],</td></tr><tr><td class="line-number" value="687"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="688"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="689"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="690"></td><td class="line-content">	[250,243,  0,255],</td></tr><tr><td class="line-number" value="691"></td><td class="line-content">	[255,248,202,255],</td></tr><tr><td class="line-number" value="692"></td><td class="line-content">	[255,159,157,255],</td></tr><tr><td class="line-number" value="693"></td><td class="line-content">	[255,206,182,255],</td></tr><tr><td class="line-number" value="694"></td><td class="line-content">	[  0,  0,  0,255],</td></tr><tr><td class="line-number" value="695"></td><td class="line-content">	[170,  0,126,255],</td></tr><tr><td class="line-number" value="696"></td><td class="line-content">	[220,  0,123,255],</td></tr><tr><td class="line-number" value="697"></td><td class="line-content">	[215,143,185,255],</td></tr><tr><td class="line-number" value="698"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="699"></td><td class="line-content">	[  0,159, 44,255],</td></tr><tr><td class="line-number" value="700"></td><td class="line-content">	[ 88,196,  0,255],</td></tr><tr><td class="line-number" value="701"></td><td class="line-content">	[176,222,  0,255],</td></tr><tr><td class="line-number" value="702"></td><td class="line-content">	[  0,103, 51,255],</td></tr><tr><td class="line-number" value="703"></td><td class="line-content">	[  0,133, 47,255],</td></tr><tr><td class="line-number" value="704"></td><td class="line-content">	[  0,164,193,255],</td></tr><tr><td class="line-number" value="705"></td><td class="line-content">	[104,204,203,255],</td></tr><tr><td class="line-number" value="706"></td><td class="line-content">	[191,227,207,255],</td></tr><tr><td class="line-number" value="707"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="708"></td><td class="line-content">	[ 65,  6,125,255],</td></tr><tr><td class="line-number" value="709"></td><td class="line-content">	[161,129,185,255],</td></tr><tr><td class="line-number" value="710"></td><td class="line-content">	[204,189,220,255],</td></tr><tr><td class="line-number" value="711"></td><td class="line-content">	[136,170,215,255],</td></tr><tr><td class="line-number" value="712"></td><td class="line-content">	[139,169,178,255],</td></tr><tr><td class="line-number" value="713"></td><td class="line-content">	[205,187,179,255],</td></tr><tr><td class="line-number" value="714"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="715"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="716"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="717"></td><td class="line-content">	[159, 28, 44,255],</td></tr><tr><td class="line-number" value="718"></td><td class="line-content">	[212, 14, 40,255],</td></tr><tr><td class="line-number" value="719"></td><td class="line-content">	[140,129, 34,255],</td></tr><tr><td class="line-number" value="720"></td><td class="line-content">	[200,143,  0,255],</td></tr><tr><td class="line-number" value="721"></td><td class="line-content">	[199,181,  0,255],</td></tr><tr><td class="line-number" value="722"></td><td class="line-content">	[121,164, 17,255],</td></tr><tr><td class="line-number" value="723"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="724"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="725"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="726"></td><td class="line-content">], "CBM64": [ //https://commons.wikimedia.org/wiki/File:C64_ntsc_cxa2025.bmp.png</td></tr><tr><td class="line-number" value="727"></td><td class="line-content">	[  0,  0,  0,255],</td></tr><tr><td class="line-number" value="728"></td><td class="line-content">	[255,255,255,255],</td></tr><tr><td class="line-number" value="729"></td><td class="line-content">	[250, 50,  0,255],</td></tr><tr><td class="line-number" value="730"></td><td class="line-content">	[ 27,227,255,255],</td></tr><tr><td class="line-number" value="731"></td><td class="line-content">	[171, 71,216,255],</td></tr><tr><td class="line-number" value="732"></td><td class="line-content">	[104,186, 81,255],</td></tr><tr><td class="line-number" value="733"></td><td class="line-content">	[  0, 74,208,255],</td></tr><tr><td class="line-number" value="734"></td><td class="line-content">	[255,233, 77,255],</td></tr><tr><td class="line-number" value="735"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="736"></td><td class="line-content">	[255, 91,  0,255],</td></tr><tr><td class="line-number" value="737"></td><td class="line-content">	[193, 62,  0,255],</td></tr><tr><td class="line-number" value="738"></td><td class="line-content">	[255,114, 90,255],</td></tr><tr><td class="line-number" value="739"></td><td class="line-content">	[ 96, 94, 98,255],</td></tr><tr><td class="line-number" value="740"></td><td class="line-content">	[144,144,144,255],</td></tr><tr><td class="line-number" value="741"></td><td class="line-content">	[177,255,138,255],</td></tr><tr><td class="line-number" value="742"></td><td class="line-content">	[ 67,140,255,255],</td></tr><tr><td class="line-number" value="743"></td><td class="line-content">	[200,200,200,255],</td></tr><tr><td class="line-number" value="744"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="745"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="746"></td><td class="line-content">], "Puzzlescript": [</td></tr><tr><td class="line-number" value="747"></td><td class="line-content">	[0x00,0x00,0x00, 255],</td></tr><tr><td class="line-number" value="748"></td><td class="line-content">	[0xFF,0xFF,0xFF, 255],</td></tr><tr><td class="line-number" value="749"></td><td class="line-content">	[0x9d,0x9d,0x9d, 255],</td></tr><tr><td class="line-number" value="750"></td><td class="line-content">	[0x69,0x71,0x75, 255],</td></tr><tr><td class="line-number" value="751"></td><td class="line-content">	[0xcc,0xcc,0xcc, 255],</td></tr><tr><td class="line-number" value="752"></td><td class="line-content">	[0xbe,0x26,0x33, 255],</td></tr><tr><td class="line-number" value="753"></td><td class="line-content">	[0x73,0x29,0x30, 255],</td></tr><tr><td class="line-number" value="754"></td><td class="line-content">	[0xe0,0x6f,0x8b, 255],</td></tr><tr><td class="line-number" value="755"></td><td class="line-content">	[0xa4,0x64,0x22, 255],</td></tr><tr><td class="line-number" value="756"></td><td class="line-content">	[0x49,0x3c,0x2b, 255],</td></tr><tr><td class="line-number" value="757"></td><td class="line-content">	[0xee,0xb6,0x2f, 255],</td></tr><tr><td class="line-number" value="758"></td><td class="line-content">	[0xeb,0x89,0x31, 255],</td></tr><tr><td class="line-number" value="759"></td><td class="line-content">	[0xf7,0xe2,0x6b, 255],</td></tr><tr><td class="line-number" value="760"></td><td class="line-content">	[0x44,0x89,0x1a, 255],</td></tr><tr><td class="line-number" value="761"></td><td class="line-content">	[0x2f,0x48,0x4e, 255],</td></tr><tr><td class="line-number" value="762"></td><td class="line-content">	[0xa3,0xce,0x27, 255],</td></tr><tr><td class="line-number" value="763"></td><td class="line-content">	[0x1d,0x57,0xf7, 255],</td></tr><tr><td class="line-number" value="764"></td><td class="line-content">	[0xB2,0xDC,0xEF, 255],</td></tr><tr><td class="line-number" value="765"></td><td class="line-content">	[0x1B,0x26,0x32, 255],</td></tr><tr><td class="line-number" value="766"></td><td class="line-content">	[0x34,0x2a,0x97, 255],</td></tr><tr><td class="line-number" value="767"></td><td class="line-content">	[0xde,0x65,0xe2, 255],</td></tr><tr><td class="line-number" value="768"></td><td class="line-content">	[  0,  0,  0,  0],</td></tr><tr><td class="line-number" value="769"></td><td class="line-content">]</td></tr><tr><td class="line-number" value="770"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="771"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="772"></td><td class="line-content">var puzzlescriptcolornames = ["black", "white", "grey", "darkgrey", "lightgrey",</td></tr><tr><td class="line-number" value="773"></td><td class="line-content">"red", "darkred", "lightred", "brown", "darkbrown", "lightbrown", "orange",</td></tr><tr><td class="line-number" value="774"></td><td class="line-content">"yellow", "green", "darkgreen", "lightgreen", "blue", "lightblue", "darkblue",</td></tr><tr><td class="line-number" value="775"></td><td class="line-content">"purple", "pink", ""];</td></tr><tr><td class="line-number" value="776"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="777"></td><td class="line-content">var spritenames = {};</td></tr><tr><td class="line-number" value="778"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="779"></td><td class="line-content">document.getElementById("palettename").selectedIndex = 0;</td></tr><tr><td class="line-number" value="780"></td><td class="line-content">var palettecolors = palettes["Standard"];</td></tr><tr><td class="line-number" value="781"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="782"></td><td class="line-content">// restore sprites and config</td></tr><tr><td class="line-number" value="783"></td><td class="line-content">doAutorestore();</td></tr><tr><td class="line-number" value="784"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="785"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="786"></td><td class="line-content">// events</td></tr><tr><td class="line-number" value="787"></td><td class="line-content">spritecanvas.addEventListener("click", function(e) {</td></tr><tr><td class="line-number" value="788"></td><td class="line-content">	var rect = spritecanvas.getBoundingClientRect();</td></tr><tr><td class="line-number" value="789"></td><td class="line-content">	curtilex = Math.floor((e.clientX-rect.left) / tilex);</td></tr><tr><td class="line-number" value="790"></td><td class="line-content">	curtiley = Math.floor((e.clientY-rect.top) / tiley);</td></tr><tr><td class="line-number" value="791"></td><td class="line-content">	prevclick = {x:-1,y:-1};</td></tr><tr><td class="line-number" value="792"></td><td class="line-content">	updateTileSelect("tileselect",1);</td></tr><tr><td class="line-number" value="793"></td><td class="line-content">	updateTileSelect("tileselect_l",sprzoomlevel);</td></tr><tr><td class="line-number" value="794"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="795"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="796"></td><td class="line-content">}, false);</td></tr><tr><td class="line-number" value="797"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="798"></td><td class="line-content">spritecanvaszoom.addEventListener("click", function(e) {</td></tr><tr><td class="line-number" value="799"></td><td class="line-content">	var rect = spritecanvaszoom.getBoundingClientRect();</td></tr><tr><td class="line-number" value="800"></td><td class="line-content">	curtilex = Math.floor((e.clientX-rect.left) / (sprzoomlevel*tilex) );</td></tr><tr><td class="line-number" value="801"></td><td class="line-content">	curtiley = Math.floor((e.clientY-rect.top) / (sprzoomlevel*tiley) );</td></tr><tr><td class="line-number" value="802"></td><td class="line-content">	prevclick = {x:-1,y:-1};</td></tr><tr><td class="line-number" value="803"></td><td class="line-content">	updateTileSelect("tileselect",1);</td></tr><tr><td class="line-number" value="804"></td><td class="line-content">	updateTileSelect("tileselect_l",sprzoomlevel);</td></tr><tr><td class="line-number" value="805"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="806"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="807"></td><td class="line-content">}, false);</td></tr><tr><td class="line-number" value="808"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="809"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="810"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="811"></td><td class="line-content">// ------------------------------------------------------------</td></tr><tr><td class="line-number" value="812"></td><td class="line-content">// config: read values from input fields and update screen accordingly</td></tr><tr><td class="line-number" value="813"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="814"></td><td class="line-content">function configSetSize() {</td></tr><tr><td class="line-number" value="815"></td><td class="line-content">	var res = confirm("This operation cannot be undone! Continue?");</td></tr><tr><td class="line-number" value="816"></td><td class="line-content">	if (!res) return;</td></tr><tr><td class="line-number" value="817"></td><td class="line-content">	tilex = parseInt(document.getElementById("cfg_tilex").value);</td></tr><tr><td class="line-number" value="818"></td><td class="line-content">	tiley = parseInt(document.getElementById("cfg_tiley").value);</td></tr><tr><td class="line-number" value="819"></td><td class="line-content">	nrtilesx = parseInt(document.getElementById("cfg_nrtilesx").value);</td></tr><tr><td class="line-number" value="820"></td><td class="line-content">	nrtilesy = parseInt(document.getElementById("cfg_nrtilesy").value);</td></tr><tr><td class="line-number" value="821"></td><td class="line-content">	spritenames = {};</td></tr><tr><td class="line-number" value="822"></td><td class="line-content">	updateCanvasSizes();</td></tr><tr><td class="line-number" value="823"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="824"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="825"></td><td class="line-content">function configSpriteBG() {</td></tr><tr><td class="line-number" value="826"></td><td class="line-content">	spritebgcolor = document.getElementById("transparentcolor").value;</td></tr><tr><td class="line-number" value="827"></td><td class="line-content">	spritebgchecker = document.getElementById("transparentchecker").checked;</td></tr><tr><td class="line-number" value="828"></td><td class="line-content">	updateSpriteBG();</td></tr><tr><td class="line-number" value="829"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="830"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="831"></td><td class="line-content">function configGrid() {</td></tr><tr><td class="line-number" value="832"></td><td class="line-content">	gridcolor = document.getElementById("gridcolor").value;</td></tr><tr><td class="line-number" value="833"></td><td class="line-content">	gridthickness = parseInt(document.getElementById("gridthickness").value);</td></tr><tr><td class="line-number" value="834"></td><td class="line-content">	selectboxcolor = document.getElementById("selectboxcolor").value;</td></tr><tr><td class="line-number" value="835"></td><td class="line-content">	updateTileSelect("tileselect",1);</td></tr><tr><td class="line-number" value="836"></td><td class="line-content">	updateTileSelect("tileselect_l",sprzoomlevel);</td></tr><tr><td class="line-number" value="837"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="838"></td><td class="line-content">	updatePalette();</td></tr><tr><td class="line-number" value="839"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="840"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="841"></td><td class="line-content">function configZoom() {</td></tr><tr><td class="line-number" value="842"></td><td class="line-content">	zoomlevel = parseInt(document.getElementById("zoomlevel").value);</td></tr><tr><td class="line-number" value="843"></td><td class="line-content">	sprzoomlevel = parseInt(document.getElementById("sprzoomlevel").value);</td></tr><tr><td class="line-number" value="844"></td><td class="line-content">	updateCanvasSize(spritecanvaszoom,sprzoomlevel);</td></tr><tr><td class="line-number" value="845"></td><td class="line-content">	updateTileSelect("tileselect",1);</td></tr><tr><td class="line-number" value="846"></td><td class="line-content">	updateTileSelect("tileselect_l",sprzoomlevel);</td></tr><tr><td class="line-number" value="847"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="848"></td><td class="line-content">	updateZoomedSprite();</td></tr><tr><td class="line-number" value="849"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="850"></td><td class="line-content">	updatePreviewSizes();</td></tr><tr><td class="line-number" value="851"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="852"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="853"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="854"></td><td class="line-content">function configGlobal() {</td></tr><tr><td class="line-number" value="855"></td><td class="line-content">	document.body.style.backgroundColor =</td></tr><tr><td class="line-number" value="856"></td><td class="line-content">		document.getElementById("globalbackground").value;</td></tr><tr><td class="line-number" value="857"></td><td class="line-content">	document.body.style.color = </td></tr><tr><td class="line-number" value="858"></td><td class="line-content">		document.getElementById("globalforeground").value;</td></tr><tr><td class="line-number" value="859"></td><td class="line-content">	//document.body.style.color = 0.3*pencolor[0]+0.55*pencolor[1]+0.15*pencolor[2] &lt; 128</td></tr><tr><td class="line-number" value="860"></td><td class="line-content">	//	? "#fff" : "#000";</td></tr><tr><td class="line-number" value="861"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="862"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="863"></td><td class="line-content">function configOnionSkin() {</td></tr><tr><td class="line-number" value="864"></td><td class="line-content">	onionskin.bgTrans=Number(document.getElementById("onionskinbgtrans").value);</td></tr><tr><td class="line-number" value="865"></td><td class="line-content">	onionskin.size=Number(document.getElementById("onionskinsize").value);</td></tr><tr><td class="line-number" value="866"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="867"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="868"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="869"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="870"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="871"></td><td class="line-content">function setAnimFrame(which) {</td></tr><tr><td class="line-number" value="872"></td><td class="line-content">	anim[which+"frame"].x = curtilex;</td></tr><tr><td class="line-number" value="873"></td><td class="line-content">	anim[which+"frame"].y = curtiley;</td></tr><tr><td class="line-number" value="874"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="875"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="876"></td><td class="line-content">function configAnim() {</td></tr><tr><td class="line-number" value="877"></td><td class="line-content">	anim.delay = parseInt(document.getElementById("animdelay").value);</td></tr><tr><td class="line-number" value="878"></td><td class="line-content">	if (anim.delay &lt; 40) anim.delay = 40;</td></tr><tr><td class="line-number" value="879"></td><td class="line-content">	if (anim.delay &gt; 1000) anim.delay = 1000;</td></tr><tr><td class="line-number" value="880"></td><td class="line-content">	anim.pingpong = document.getElementById("animpingpong").checked;</td></tr><tr><td class="line-number" value="881"></td><td class="line-content">	toggleAnimation();</td></tr><tr><td class="line-number" value="882"></td><td class="line-content">	toggleAnimation();</td></tr><tr><td class="line-number" value="883"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="884"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="885"></td><td class="line-content">function setPenColorFromText() {</td></tr><tr><td class="line-number" value="886"></td><td class="line-content">	var text = document.getElementById("pencolor-text").value.trim();</td></tr><tr><td class="line-number" value="887"></td><td class="line-content">	pencolor = getColorFromHexString(text);</td></tr><tr><td class="line-number" value="888"></td><td class="line-content">	updatePenColor();</td></tr><tr><td class="line-number" value="889"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="890"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="891"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="892"></td><td class="line-content">function getColorFromHexString(text) {</td></tr><tr><td class="line-number" value="893"></td><td class="line-content">	if (text.charAt(0) != "#") return;</td></tr><tr><td class="line-number" value="894"></td><td class="line-content">	text = text.substring(1);</td></tr><tr><td class="line-number" value="895"></td><td class="line-content">	var col = [0,0,0,255];</td></tr><tr><td class="line-number" value="896"></td><td class="line-content">	if (text.length==6) {</td></tr><tr><td class="line-number" value="897"></td><td class="line-content">		text = "ff"+text;</td></tr><tr><td class="line-number" value="898"></td><td class="line-content">	} else if (text.length==3) {</td></tr><tr><td class="line-number" value="899"></td><td class="line-content">		text = "f"+text;</td></tr><tr><td class="line-number" value="900"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="901"></td><td class="line-content">	if (text.length == 8) {</td></tr><tr><td class="line-number" value="902"></td><td class="line-content">		col[3] = parseInt(text.substring(0,2),16);</td></tr><tr><td class="line-number" value="903"></td><td class="line-content">		col[0] = parseInt(text.substring(2,4),16);</td></tr><tr><td class="line-number" value="904"></td><td class="line-content">		col[1] = parseInt(text.substring(4,6),16);</td></tr><tr><td class="line-number" value="905"></td><td class="line-content">		col[2] = parseInt(text.substring(6,8),16);</td></tr><tr><td class="line-number" value="906"></td><td class="line-content">	} else if (text.length==4) {</td></tr><tr><td class="line-number" value="907"></td><td class="line-content">		col[3] = parseInt(text.substring(0,1)+text.substring(0,1),16);</td></tr><tr><td class="line-number" value="908"></td><td class="line-content">		col[0] = parseInt(text.substring(1,2)+text.substring(1,2),16);</td></tr><tr><td class="line-number" value="909"></td><td class="line-content">		col[1] = parseInt(text.substring(2,3)+text.substring(2,3),16);</td></tr><tr><td class="line-number" value="910"></td><td class="line-content">		col[2] = parseInt(text.substring(3,4)+text.substring(3,4),16);</td></tr><tr><td class="line-number" value="911"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="912"></td><td class="line-content">	return col;</td></tr><tr><td class="line-number" value="913"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="914"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="915"></td><td class="line-content">function setPalette(elem) {</td></tr><tr><td class="line-number" value="916"></td><td class="line-content">	palettecolors = palettes[elem.options[elem.selectedIndex].value];</td></tr><tr><td class="line-number" value="917"></td><td class="line-content">	updatePalette();</td></tr><tr><td class="line-number" value="918"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="919"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="920"></td><td class="line-content">// ------------------------------------------------------------</td></tr><tr><td class="line-number" value="921"></td><td class="line-content">// update</td></tr><tr><td class="line-number" value="922"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="923"></td><td class="line-content">function updatePenColor() {</td></tr><tr><td class="line-number" value="924"></td><td class="line-content">	var elem = document.getElementById("pencolor");</td></tr><tr><td class="line-number" value="925"></td><td class="line-content">	var elemtext = document.getElementById("pencolor-text");</td></tr><tr><td class="line-number" value="926"></td><td class="line-content">	elemtext.value = getHexString(pencolor);</td></tr><tr><td class="line-number" value="927"></td><td class="line-content">	elem.style.backgroundColor = getRGBAString(pencolor);</td></tr><tr><td class="line-number" value="928"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="929"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="930"></td><td class="line-content">function updateCanvasSizes() {</td></tr><tr><td class="line-number" value="931"></td><td class="line-content">	updateCanvasSize(spritecanvas,1);</td></tr><tr><td class="line-number" value="932"></td><td class="line-content">	updateCanvasSize(spritecanvaszoom,sprzoomlevel);</td></tr><tr><td class="line-number" value="933"></td><td class="line-content">	updateTileSelect("tileselect",1);</td></tr><tr><td class="line-number" value="934"></td><td class="line-content">	updateTileSelect("tileselect_l",sprzoomlevel);</td></tr><tr><td class="line-number" value="935"></td><td class="line-content">	// buffers</td></tr><tr><td class="line-number" value="936"></td><td class="line-content">	cutbuffer = document.createElement("canvas");</td></tr><tr><td class="line-number" value="937"></td><td class="line-content">	cutbuffer.width = tilex;</td></tr><tr><td class="line-number" value="938"></td><td class="line-content">	cutbuffer.height = tiley;</td></tr><tr><td class="line-number" value="939"></td><td class="line-content">	opbuffer = document.createElement("canvas");</td></tr><tr><td class="line-number" value="940"></td><td class="line-content">	opbuffer.width = tilex;</td></tr><tr><td class="line-number" value="941"></td><td class="line-content">	opbuffer.height = tiley;</td></tr><tr><td class="line-number" value="942"></td><td class="line-content">	// history</td></tr><tr><td class="line-number" value="943"></td><td class="line-content">	undohistory = {</td></tr><tr><td class="line-number" value="944"></td><td class="line-content">		list: [],</td></tr><tr><td class="line-number" value="945"></td><td class="line-content">		pos: 0, // points to most recent history</td></tr><tr><td class="line-number" value="946"></td><td class="line-content">		lastpos: 0, // points to last item stored</td></tr><tr><td class="line-number" value="947"></td><td class="line-content">	};</td></tr><tr><td class="line-number" value="948"></td><td class="line-content">	for (var i=0; i&lt;40; i++) {</td></tr><tr><td class="line-number" value="949"></td><td class="line-content">		var canv = document.createElement("canvas");</td></tr><tr><td class="line-number" value="950"></td><td class="line-content">		canv.width = nrtilesx*tilex;</td></tr><tr><td class="line-number" value="951"></td><td class="line-content">		canv.height = nrtilesy*tiley;</td></tr><tr><td class="line-number" value="952"></td><td class="line-content">		undohistory.list.push(canv);</td></tr><tr><td class="line-number" value="953"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="954"></td><td class="line-content">	updatePreviewSizes();</td></tr><tr><td class="line-number" value="955"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="956"></td><td class="line-content">	doAutosaveConfig();</td></tr><tr><td class="line-number" value="957"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="958"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="959"></td><td class="line-content">function updatePreviewSizes() {</td></tr><tr><td class="line-number" value="960"></td><td class="line-content">	updateCanvasSize(document.getElementById("tilepreview"),1,3,3);</td></tr><tr><td class="line-number" value="961"></td><td class="line-content">	updateCanvasSize(document.getElementById("tilepreview_l"),sprzoomlevel,3,3);</td></tr><tr><td class="line-number" value="962"></td><td class="line-content">	updateCanvasSize(document.getElementById("animpreview"),1,1,1);</td></tr><tr><td class="line-number" value="963"></td><td class="line-content">	updateCanvasSize(document.getElementById("animpreview_l"),sprzoomlevel,1,1);</td></tr><tr><td class="line-number" value="964"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="965"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="966"></td><td class="line-content">function updateCanvasSize(elem,zoom,nrtx,nrty) {</td></tr><tr><td class="line-number" value="967"></td><td class="line-content">	if (!nrtx) nrtx = nrtilesx;</td></tr><tr><td class="line-number" value="968"></td><td class="line-content">	if (!nrty) nrty = nrtilesy;</td></tr><tr><td class="line-number" value="969"></td><td class="line-content">	elem.style.width = zoom*tilex*nrtx;</td></tr><tr><td class="line-number" value="970"></td><td class="line-content">	elem.width = zoom*tilex*nrtx;</td></tr><tr><td class="line-number" value="971"></td><td class="line-content">	elem.style.height = zoom*tiley*nrty;</td></tr><tr><td class="line-number" value="972"></td><td class="line-content">	elem.height = zoom*tiley*nrty;</td></tr><tr><td class="line-number" value="973"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="974"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="975"></td><td class="line-content">function updateTileSelect(elem,zoom) {</td></tr><tr><td class="line-number" value="976"></td><td class="line-content">	var tileselect = document.getElementById(elem);</td></tr><tr><td class="line-number" value="977"></td><td class="line-content">	var tileselectbox = document.getElementById(elem+"box");</td></tr><tr><td class="line-number" value="978"></td><td class="line-content">	if (curtilex &gt;= nrtilesx) curtilex=nrtilesx-1;</td></tr><tr><td class="line-number" value="979"></td><td class="line-content">	if (curtiley &gt;= nrtilesy) curtiley=nrtilesy-1;</td></tr><tr><td class="line-number" value="980"></td><td class="line-content">	//alert(" "+curtilex+" "+curtiley);</td></tr><tr><td class="line-number" value="981"></td><td class="line-content">	tileselect.style.left = zoom*curtilex*tilex;</td></tr><tr><td class="line-number" value="982"></td><td class="line-content">	tileselect.style.top = zoom*curtiley*tiley;</td></tr><tr><td class="line-number" value="983"></td><td class="line-content">	tileselectbox.style.width = zoom*tilex;</td></tr><tr><td class="line-number" value="984"></td><td class="line-content">	tileselectbox.style.height = zoom*tiley;</td></tr><tr><td class="line-number" value="985"></td><td class="line-content">	tileselectbox.style.border = "1px solid "+selectboxcolor;</td></tr><tr><td class="line-number" value="986"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="987"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="988"></td><td class="line-content">function updateZoomedSprite(srcelem,dstelem,tx,ty,width,height) {</td></tr><tr><td class="line-number" value="989"></td><td class="line-content">	if (!srcelem) srcelem=spritecanvas;</td></tr><tr><td class="line-number" value="990"></td><td class="line-content">	if (!dstelem) dstelem=spritecanvaszoom;</td></tr><tr><td class="line-number" value="991"></td><td class="line-content">	if (!tx) tx=0;</td></tr><tr><td class="line-number" value="992"></td><td class="line-content">	if (!ty) ty=0;</td></tr><tr><td class="line-number" value="993"></td><td class="line-content">	if (!width) width = tilex*nrtilesx;</td></tr><tr><td class="line-number" value="994"></td><td class="line-content">	if (!height) height = tiley*nrtilesy;</td></tr><tr><td class="line-number" value="995"></td><td class="line-content">	var data = srcelem.getContext("2d")</td></tr><tr><td class="line-number" value="996"></td><td class="line-content">		.getImageData(tilex*tx,tiley*ty,width,height).data;</td></tr><tr><td class="line-number" value="997"></td><td class="line-content">	dstelem.getContext("2d").clearRect(0,0,</td></tr><tr><td class="line-number" value="998"></td><td class="line-content">		sprzoomlevel*nrtilesx*tilex,sprzoomlevel*nrtilesy*tiley);</td></tr><tr><td class="line-number" value="999"></td><td class="line-content">	var idx=0;</td></tr><tr><td class="line-number" value="1000"></td><td class="line-content">	for (var y=0; y&lt;height; y++) {</td></tr><tr><td class="line-number" value="1001"></td><td class="line-content">		for (var x=0; x&lt;width; x++) {</td></tr><tr><td class="line-number" value="1002"></td><td class="line-content">			if (data[idx+3] != 0) {</td></tr><tr><td class="line-number" value="1003"></td><td class="line-content">				setColor(dstelem,sprzoomlevel, x, y,</td></tr><tr><td class="line-number" value="1004"></td><td class="line-content">					[data[idx],data[idx+1],data[idx+2],data[idx+3]]);</td></tr><tr><td class="line-number" value="1005"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1006"></td><td class="line-content">			idx += 4;</td></tr><tr><td class="line-number" value="1007"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1008"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1009"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1010"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1011"></td><td class="line-content">function updatePreviews() {</td></tr><tr><td class="line-number" value="1012"></td><td class="line-content">	var tilecanv = document.getElementById("tilepreview");</td></tr><tr><td class="line-number" value="1013"></td><td class="line-content">	var ctx = tilecanv.getContext('2d');</td></tr><tr><td class="line-number" value="1014"></td><td class="line-content">	ctx.clearRect(0,0,tilex*3,tiley*3);</td></tr><tr><td class="line-number" value="1015"></td><td class="line-content">	for (var y=0; y&lt;3; y++) {</td></tr><tr><td class="line-number" value="1016"></td><td class="line-content">		for (var x=0; x&lt;3; x++) {</td></tr><tr><td class="line-number" value="1017"></td><td class="line-content">			ctx.drawImage(spritecanvas,</td></tr><tr><td class="line-number" value="1018"></td><td class="line-content">				tilex*curtilex,tiley*curtiley,tilex,tiley,</td></tr><tr><td class="line-number" value="1019"></td><td class="line-content">				tilex*x,tiley*y,tilex,tiley);</td></tr><tr><td class="line-number" value="1020"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1021"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1022"></td><td class="line-content">	var tilecanvzoom = document.getElementById("tilepreview_l");</td></tr><tr><td class="line-number" value="1023"></td><td class="line-content">	updateZoomedSprite(tilecanv,tilecanvzoom,0,0,tilex*3,tiley*3);</td></tr><tr><td class="line-number" value="1024"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1025"></td><td class="line-content">	//updateCanvasSize(document.getElementById("tilepreview"),1,3,3);</td></tr><tr><td class="line-number" value="1026"></td><td class="line-content">	//updateCanvasSize(document.getElementById("tilepreview_l"),sprzoomlevel,3,3);</td></tr><tr><td class="line-number" value="1027"></td><td class="line-content">	//updateCanvasSize(document.getElementById("animpreview"),1,1,1);</td></tr><tr><td class="line-number" value="1028"></td><td class="line-content">	//updateCanvasSize(document.getElementById("animpreview_l"),sprzoomlevel,1,1);</td></tr><tr><td class="line-number" value="1029"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1030"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1031"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1032"></td><td class="line-content">// updates both clickable sprite and zoomed canvas</td></tr><tr><td class="line-number" value="1033"></td><td class="line-content">function updateZoom() {</td></tr><tr><td class="line-number" value="1034"></td><td class="line-content">	zoom.innerHTML = ""; // clear zoom</td></tr><tr><td class="line-number" value="1035"></td><td class="line-content">	for (var y=0; y&lt;tiley; y++) {</td></tr><tr><td class="line-number" value="1036"></td><td class="line-content">		for (var x=0; x&lt;tilex; x++) {</td></tr><tr><td class="line-number" value="1037"></td><td class="line-content">			var div = createPixelDiv(x,y);</td></tr><tr><td class="line-number" value="1038"></td><td class="line-content">			zoom.appendChild(div);</td></tr><tr><td class="line-number" value="1039"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1040"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1041"></td><td class="line-content">	updateSpriteNameLine();</td></tr><tr><td class="line-number" value="1042"></td><td class="line-content">	updateSpriteBG();</td></tr><tr><td class="line-number" value="1043"></td><td class="line-content">	// do autosave here to ensure data is saved often without noticing slowdown</td></tr><tr><td class="line-number" value="1044"></td><td class="line-content">	doAutosave(false);</td></tr><tr><td class="line-number" value="1045"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1046"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1047"></td><td class="line-content">function updateSpriteBG() {</td></tr><tr><td class="line-number" value="1048"></td><td class="line-content">	var bg = "";</td></tr><tr><td class="line-number" value="1049"></td><td class="line-content">	if (spritebgchecker) bg += 'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+AFFRUeHzYTyk4AAAAvSURBVBjTY2RgYNBgYGBg+P//PwMDAwMDIyMjAzKfiYEAYMGlE8YnbAIunXR0AwBawBg7lpKXIgAAAABJRU5ErkJggg=="),';</td></tr><tr><td class="line-number" value="1050"></td><td class="line-content">	bg += 'linear-gradient(to bottom, '+spritebgcolor+' 0%, '+spritebgcolor+' 100%)';</td></tr><tr><td class="line-number" value="1051"></td><td class="line-content">	var elements = document.getElementsByClassName('sprite-bg');</td></tr><tr><td class="line-number" value="1052"></td><td class="line-content">	for (var i=0; i&lt;elements.length; i++) {</td></tr><tr><td class="line-number" value="1053"></td><td class="line-content">		elements[i].style.background = bg;</td></tr><tr><td class="line-number" value="1054"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1055"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1056"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1057"></td><td class="line-content">function updateSpriteNameLine() {</td></tr><tr><td class="line-number" value="1058"></td><td class="line-content">	var val = spritenames[curtilex+","+curtiley];</td></tr><tr><td class="line-number" value="1059"></td><td class="line-content">	spritenameline.value = val ? val : "";</td></tr><tr><td class="line-number" value="1060"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1061"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1062"></td><td class="line-content">function storeSpriteNameLine() {</td></tr><tr><td class="line-number" value="1063"></td><td class="line-content">	spritenames[curtilex+","+curtiley] = spritenameline.value;</td></tr><tr><td class="line-number" value="1064"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1065"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1066"></td><td class="line-content">// ------------------------------------------------------------</td></tr><tr><td class="line-number" value="1067"></td><td class="line-content">// history and cut buffer</td></tr><tr><td class="line-number" value="1068"></td><td class="line-content">//https://dzone.com/articles/cross-browser-javascript-copy-and-paste</td></tr><tr><td class="line-number" value="1069"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1070"></td><td class="line-content">function storeHistory(singlepixel) {</td></tr><tr><td class="line-number" value="1071"></td><td class="line-content">	undohistory.pos = (undohistory.pos+1) % undohistory.list.length;</td></tr><tr><td class="line-number" value="1072"></td><td class="line-content">	undohistory.lastpos = undohistory.pos;</td></tr><tr><td class="line-number" value="1073"></td><td class="line-content">	undohistory.list[undohistory.pos].getContext('2d').clearRect(</td></tr><tr><td class="line-number" value="1074"></td><td class="line-content">		0,0, tilex*nrtilesx,tiley*nrtilesy);</td></tr><tr><td class="line-number" value="1075"></td><td class="line-content">	undohistory.list[undohistory.pos].getContext('2d').drawImage(spritecanvas,0,0);</td></tr><tr><td class="line-number" value="1076"></td><td class="line-content">	doAutosave(singlepixel);</td></tr><tr><td class="line-number" value="1077"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1078"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1079"></td><td class="line-content">function retrieveHistory(forwards) {</td></tr><tr><td class="line-number" value="1080"></td><td class="line-content">	prevclick = {x:-1,y:-1};</td></tr><tr><td class="line-number" value="1081"></td><td class="line-content">	spritecanvas.getContext("2d").clearRect(</td></tr><tr><td class="line-number" value="1082"></td><td class="line-content">		0,0, tilex*nrtilesx,tiley*nrtilesy);</td></tr><tr><td class="line-number" value="1083"></td><td class="line-content">	if (!forwards) {</td></tr><tr><td class="line-number" value="1084"></td><td class="line-content">		undohistory.pos--;</td></tr><tr><td class="line-number" value="1085"></td><td class="line-content">		if (undohistory.pos &lt; 0) undohistory.pos = undohistory.list.length-1;</td></tr><tr><td class="line-number" value="1086"></td><td class="line-content">	} else if (undohistory.pos &lt; undohistory.lastpos) {</td></tr><tr><td class="line-number" value="1087"></td><td class="line-content">		undohistory.pos = (undohistory.pos+1) % undohistory.list.length;</td></tr><tr><td class="line-number" value="1088"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1089"></td><td class="line-content">	spritecanvas.getContext("2d").drawImage(undohistory.list[undohistory.pos],0,0);</td></tr><tr><td class="line-number" value="1090"></td><td class="line-content">	updateZoomedSprite();</td></tr><tr><td class="line-number" value="1091"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="1092"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="1093"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1094"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1095"></td><td class="line-content">function copySpriteToBuffer(buffer) {</td></tr><tr><td class="line-number" value="1096"></td><td class="line-content">	var ctx = buffer.getContext('2d');</td></tr><tr><td class="line-number" value="1097"></td><td class="line-content">	ctx.clearRect(0,0,tilex,tiley);</td></tr><tr><td class="line-number" value="1098"></td><td class="line-content">	ctx.drawImage(spritecanvas,curtilex*tilex,curtiley*tiley,tilex,tiley,</td></tr><tr><td class="line-number" value="1099"></td><td class="line-content">		0,0,tilex,tiley);</td></tr><tr><td class="line-number" value="1100"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1101"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1102"></td><td class="line-content">function copyBufferToSprite(buffer) {</td></tr><tr><td class="line-number" value="1103"></td><td class="line-content">	prevclick = {x:-1,y:-1};</td></tr><tr><td class="line-number" value="1104"></td><td class="line-content">	var ctx = spritecanvas.getContext('2d');</td></tr><tr><td class="line-number" value="1105"></td><td class="line-content">	ctx.drawImage(buffer,0,0,tilex,tiley,</td></tr><tr><td class="line-number" value="1106"></td><td class="line-content">		curtilex*tilex,curtiley*tiley,tilex,tiley);</td></tr><tr><td class="line-number" value="1107"></td><td class="line-content">	updateZoomedSprite();</td></tr><tr><td class="line-number" value="1108"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="1109"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="1110"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1111"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1112"></td><td class="line-content">function cutSprite() {</td></tr><tr><td class="line-number" value="1113"></td><td class="line-content">	prevclick = {x:-1,y:-1};</td></tr><tr><td class="line-number" value="1114"></td><td class="line-content">	copySpriteToBuffer(cutbuffer);</td></tr><tr><td class="line-number" value="1115"></td><td class="line-content">	spritecanvas.getContext('2d').clearRect(curtilex*tilex, curtiley*tiley,</td></tr><tr><td class="line-number" value="1116"></td><td class="line-content">		tilex,tiley);</td></tr><tr><td class="line-number" value="1117"></td><td class="line-content">	storeHistory();</td></tr><tr><td class="line-number" value="1118"></td><td class="line-content">	updateZoomedSprite();</td></tr><tr><td class="line-number" value="1119"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="1120"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="1121"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1122"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1123"></td><td class="line-content">function copySprite() {</td></tr><tr><td class="line-number" value="1124"></td><td class="line-content">	copySpriteToBuffer(cutbuffer);</td></tr><tr><td class="line-number" value="1125"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1126"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1127"></td><td class="line-content">function pasteSprite() {</td></tr><tr><td class="line-number" value="1128"></td><td class="line-content">	spritecanvas.getContext('2d').clearRect(curtilex*tilex, curtiley*tiley,</td></tr><tr><td class="line-number" value="1129"></td><td class="line-content">		tilex,tiley);</td></tr><tr><td class="line-number" value="1130"></td><td class="line-content">	copyBufferToSprite(cutbuffer);</td></tr><tr><td class="line-number" value="1131"></td><td class="line-content">	storeHistory();</td></tr><tr><td class="line-number" value="1132"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1133"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1134"></td><td class="line-content">function mergeSprite() {</td></tr><tr><td class="line-number" value="1135"></td><td class="line-content">	copyBufferToSprite(cutbuffer);</td></tr><tr><td class="line-number" value="1136"></td><td class="line-content">	storeHistory();</td></tr><tr><td class="line-number" value="1137"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1138"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1139"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1140"></td><td class="line-content">// ------------------------------------------------------------</td></tr><tr><td class="line-number" value="1141"></td><td class="line-content">// autosave, save/restore config</td></tr><tr><td class="line-number" value="1142"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1143"></td><td class="line-content">function doAutosave(singlepixel) {</td></tr><tr><td class="line-number" value="1144"></td><td class="line-content">	if (!localStorage) return;</td></tr><tr><td class="line-number" value="1145"></td><td class="line-content">	if (singlepixel) {</td></tr><tr><td class="line-number" value="1146"></td><td class="line-content">		if (nrPixelsBeforeAutosave-- &gt; 0) {</td></tr><tr><td class="line-number" value="1147"></td><td class="line-content">			return;</td></tr><tr><td class="line-number" value="1148"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1149"></td><td class="line-content">		nrPixelsBeforeAutosave = 20;</td></tr><tr><td class="line-number" value="1150"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1151"></td><td class="line-content">	localStorage.setItem("tmtg.net.TinyPixelEditor.0",spritecanvas.toDataURL());</td></tr><tr><td class="line-number" value="1152"></td><td class="line-content">	localStorage.setItem("tmtg.net.TinyPixelEditor.0.names",</td></tr><tr><td class="line-number" value="1153"></td><td class="line-content">		JSON.stringify(spritenames));</td></tr><tr><td class="line-number" value="1154"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1155"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1156"></td><td class="line-content">function doAutosaveConfig() {</td></tr><tr><td class="line-number" value="1157"></td><td class="line-content">	if (!localStorage) return;</td></tr><tr><td class="line-number" value="1158"></td><td class="line-content">	var config = {</td></tr><tr><td class="line-number" value="1159"></td><td class="line-content">		tilex: tilex,</td></tr><tr><td class="line-number" value="1160"></td><td class="line-content">		tiley: tiley,</td></tr><tr><td class="line-number" value="1161"></td><td class="line-content">		nrtilesx: nrtilesx,</td></tr><tr><td class="line-number" value="1162"></td><td class="line-content">		nrtilesy: nrtilesy,</td></tr><tr><td class="line-number" value="1163"></td><td class="line-content">	};</td></tr><tr><td class="line-number" value="1164"></td><td class="line-content">	localStorage.setItem("tmtg.net.TinyPixelEditor.config",</td></tr><tr><td class="line-number" value="1165"></td><td class="line-content">		JSON.stringify(config));</td></tr><tr><td class="line-number" value="1166"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1167"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1168"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1169"></td><td class="line-content">function restoreConfigItems(config,items) {</td></tr><tr><td class="line-number" value="1170"></td><td class="line-content">	for (var i=0; i&lt;items.length; i++) {</td></tr><tr><td class="line-number" value="1171"></td><td class="line-content">		var item = items[i];</td></tr><tr><td class="line-number" value="1172"></td><td class="line-content">		var value = config[item];</td></tr><tr><td class="line-number" value="1173"></td><td class="line-content">		window[item] = value;</td></tr><tr><td class="line-number" value="1174"></td><td class="line-content">		document.getElementById("cfg_"+item).value = value;</td></tr><tr><td class="line-number" value="1175"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1176"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1177"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1178"></td><td class="line-content">function doAutorestore() {</td></tr><tr><td class="line-number" value="1179"></td><td class="line-content">	if (!localStorage) return;</td></tr><tr><td class="line-number" value="1180"></td><td class="line-content">	var url = localStorage.getItem("tmtg.net.TinyPixelEditor.0");</td></tr><tr><td class="line-number" value="1181"></td><td class="line-content">	if (url) setImageFromDataUrl(url,"all");</td></tr><tr><td class="line-number" value="1182"></td><td class="line-content">	var config = JSON.parse(</td></tr><tr><td class="line-number" value="1183"></td><td class="line-content">		localStorage.getItem("tmtg.net.TinyPixelEditor.config") );</td></tr><tr><td class="line-number" value="1184"></td><td class="line-content">	if (config) {</td></tr><tr><td class="line-number" value="1185"></td><td class="line-content">		restoreConfigItems(config, ["tilex","tiley","nrtilesx","nrtilesy"]);</td></tr><tr><td class="line-number" value="1186"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1187"></td><td class="line-content">	spritenames = JSON.parse(</td></tr><tr><td class="line-number" value="1188"></td><td class="line-content">		localStorage.getItem("tmtg.net.TinyPixelEditor.0.names") );</td></tr><tr><td class="line-number" value="1189"></td><td class="line-content">	if (!spritenames) spritenames = {};</td></tr><tr><td class="line-number" value="1190"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1191"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1192"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1193"></td><td class="line-content">// ------------------------------------------------------------</td></tr><tr><td class="line-number" value="1194"></td><td class="line-content">// commands: startCommand, select pixel to execute command</td></tr><tr><td class="line-number" value="1195"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1196"></td><td class="line-content">var curCommand = null; // null indicates default (drawing)</td></tr><tr><td class="line-number" value="1197"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1198"></td><td class="line-content">var commandTexts = {</td></tr><tr><td class="line-number" value="1199"></td><td class="line-content">	PickPenColor: "Select pixel to pick color of",</td></tr><tr><td class="line-number" value="1200"></td><td class="line-content">	ReplaceColor: "Select pixel to replace color of",</td></tr><tr><td class="line-number" value="1201"></td><td class="line-content">	FloodFill4: "Select start pixel for 4-directional flood fill",</td></tr><tr><td class="line-number" value="1202"></td><td class="line-content">	FloodFill8: "Select start pixel for 8-directional flood fill",</td></tr><tr><td class="line-number" value="1203"></td><td class="line-content">	DelRow: "Select pixel of row to delete",</td></tr><tr><td class="line-number" value="1204"></td><td class="line-content">	DelColumn: "Select pixel of column to delete",</td></tr><tr><td class="line-number" value="1205"></td><td class="line-content">	InsRow: "Select position to insert row",</td></tr><tr><td class="line-number" value="1206"></td><td class="line-content">	InsColumn: "Select position to insert column",</td></tr><tr><td class="line-number" value="1207"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1208"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1209"></td><td class="line-content">function startCommand(command) {</td></tr><tr><td class="line-number" value="1210"></td><td class="line-content">	curCommand = command;</td></tr><tr><td class="line-number" value="1211"></td><td class="line-content">	// show command text in command box</td></tr><tr><td class="line-number" value="1212"></td><td class="line-content">	openPopup("commandline",true);</td></tr><tr><td class="line-number" value="1213"></td><td class="line-content">	document.getElementById("commandline-text").innerHTML =</td></tr><tr><td class="line-number" value="1214"></td><td class="line-content">		commandTexts[command];</td></tr><tr><td class="line-number" value="1215"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1216"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1217"></td><td class="line-content">function closeCommand(command) {</td></tr><tr><td class="line-number" value="1218"></td><td class="line-content">	curCommand = null;</td></tr><tr><td class="line-number" value="1219"></td><td class="line-content">	openPopup("commandline",false);</td></tr><tr><td class="line-number" value="1220"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1221"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1222"></td><td class="line-content">function commandDelRow(x,y) {</td></tr><tr><td class="line-number" value="1223"></td><td class="line-content">	transformSprite("DelRow",{row:y});</td></tr><tr><td class="line-number" value="1224"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1225"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1226"></td><td class="line-content">function commandDelColumn(x,y) {</td></tr><tr><td class="line-number" value="1227"></td><td class="line-content">	transformSprite("DelColumn",{col:x});</td></tr><tr><td class="line-number" value="1228"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1229"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1230"></td><td class="line-content">function commandInsRow(x,y) {</td></tr><tr><td class="line-number" value="1231"></td><td class="line-content">	transformSprite("InsRow",{row:y});</td></tr><tr><td class="line-number" value="1232"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1233"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1234"></td><td class="line-content">function commandInsColumn(x,y) {</td></tr><tr><td class="line-number" value="1235"></td><td class="line-content">	transformSprite("InsColumn",{col:x});</td></tr><tr><td class="line-number" value="1236"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1237"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1238"></td><td class="line-content">function commandReplaceColor(x,y) {</td></tr><tr><td class="line-number" value="1239"></td><td class="line-content">	var srccolor = pickColor(curtilex*tilex + x,curtiley*tiley + y);</td></tr><tr><td class="line-number" value="1240"></td><td class="line-content">	replaceColor(srccolor);</td></tr><tr><td class="line-number" value="1241"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1242"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1243"></td><td class="line-content">function recurseFloodFill(map,x,y,dir8) {</td></tr><tr><td class="line-number" value="1244"></td><td class="line-content">	if (x&lt;0 || x&gt;=tilex || y&lt;0 || y&gt;=tiley) return;</td></tr><tr><td class="line-number" value="1245"></td><td class="line-content">	if (!map[y][x]) return;</td></tr><tr><td class="line-number" value="1246"></td><td class="line-content">	setColor(spritecanvas,1,curtilex*tilex + x,curtiley*tiley + y,pencolor);</td></tr><tr><td class="line-number" value="1247"></td><td class="line-content">	map[y][x] = false;</td></tr><tr><td class="line-number" value="1248"></td><td class="line-content">	recurseFloodFill(map,x-1,y,dir8);</td></tr><tr><td class="line-number" value="1249"></td><td class="line-content">	recurseFloodFill(map,x+1,y,dir8);</td></tr><tr><td class="line-number" value="1250"></td><td class="line-content">	recurseFloodFill(map,x,y-1,dir8);</td></tr><tr><td class="line-number" value="1251"></td><td class="line-content">	recurseFloodFill(map,x,y+1,dir8);</td></tr><tr><td class="line-number" value="1252"></td><td class="line-content">	if (dir8) {</td></tr><tr><td class="line-number" value="1253"></td><td class="line-content">		recurseFloodFill(map,x-1,y-1,dir8);</td></tr><tr><td class="line-number" value="1254"></td><td class="line-content">		recurseFloodFill(map,x+1,y-1,dir8);</td></tr><tr><td class="line-number" value="1255"></td><td class="line-content">		recurseFloodFill(map,x-1,y+1,dir8);</td></tr><tr><td class="line-number" value="1256"></td><td class="line-content">		recurseFloodFill(map,x+1,y+1,dir8);</td></tr><tr><td class="line-number" value="1257"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1258"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1259"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1260"></td><td class="line-content">function commandFloodFill4(x,y) {</td></tr><tr><td class="line-number" value="1261"></td><td class="line-content">	commandFloodFill(x,y,false);</td></tr><tr><td class="line-number" value="1262"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1263"></td><td class="line-content">function commandFloodFill8(x,y) {</td></tr><tr><td class="line-number" value="1264"></td><td class="line-content">	commandFloodFill(x,y,true);</td></tr><tr><td class="line-number" value="1265"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1266"></td><td class="line-content">function commandFloodFill(x,y,dir8) {</td></tr><tr><td class="line-number" value="1267"></td><td class="line-content">	var srccolor = pickColor(curtilex*tilex + x,curtiley*tiley + y);</td></tr><tr><td class="line-number" value="1268"></td><td class="line-content">	var map = createBinaryMap(srccolor);</td></tr><tr><td class="line-number" value="1269"></td><td class="line-content">	recurseFloodFill(map,x,y,dir8);</td></tr><tr><td class="line-number" value="1270"></td><td class="line-content">	storeHistory();</td></tr><tr><td class="line-number" value="1271"></td><td class="line-content">	updateZoomedSprite();</td></tr><tr><td class="line-number" value="1272"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="1273"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="1274"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1275"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1276"></td><td class="line-content">function commandPickPenColor(x,y) {</td></tr><tr><td class="line-number" value="1277"></td><td class="line-content">	pencolor = pickColor(curtilex*tilex + x,curtiley*tiley + y);</td></tr><tr><td class="line-number" value="1278"></td><td class="line-content">	updatePenColor();</td></tr><tr><td class="line-number" value="1279"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1280"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1281"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1282"></td><td class="line-content">// ------------------------------------------------------------</td></tr><tr><td class="line-number" value="1283"></td><td class="line-content">// animation</td></tr><tr><td class="line-number" value="1284"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1285"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1286"></td><td class="line-content">function toggleAnimation() {</td></tr><tr><td class="line-number" value="1287"></td><td class="line-content">	var togbut = document.getElementById("animtoggle");</td></tr><tr><td class="line-number" value="1288"></td><td class="line-content">	if (anim.timer) {</td></tr><tr><td class="line-number" value="1289"></td><td class="line-content">		clearInterval(anim.timer);</td></tr><tr><td class="line-number" value="1290"></td><td class="line-content">		anim.timer = null;</td></tr><tr><td class="line-number" value="1291"></td><td class="line-content">		togbut.innerHTML = "Play";</td></tr><tr><td class="line-number" value="1292"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="1293"></td><td class="line-content">		anim.timer = setInterval(doAnimation,anim.delay);</td></tr><tr><td class="line-number" value="1294"></td><td class="line-content">		togbut.innerHTML = "Stop";</td></tr><tr><td class="line-number" value="1295"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1296"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1297"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1298"></td><td class="line-content">function doAnimation() {</td></tr><tr><td class="line-number" value="1299"></td><td class="line-content">	var startFrame = anim.startframe.x + anim.startframe.y*nrtilesx;</td></tr><tr><td class="line-number" value="1300"></td><td class="line-content">	var endFrame = anim.endframe.x + anim.endframe.y*nrtilesx;</td></tr><tr><td class="line-number" value="1301"></td><td class="line-content">	if (startFrame &gt; endFrame) {</td></tr><tr><td class="line-number" value="1302"></td><td class="line-content">		var tmp = endFrame;</td></tr><tr><td class="line-number" value="1303"></td><td class="line-content">		endFrame = startFrame;</td></tr><tr><td class="line-number" value="1304"></td><td class="line-content">		startFrame = tmp;</td></tr><tr><td class="line-number" value="1305"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1306"></td><td class="line-content">	anim.currentframe += anim.direction;</td></tr><tr><td class="line-number" value="1307"></td><td class="line-content">	if (anim.currentframe &gt; endFrame) {</td></tr><tr><td class="line-number" value="1308"></td><td class="line-content">		if (anim.pingpong) {</td></tr><tr><td class="line-number" value="1309"></td><td class="line-content">			anim.direction = -1;</td></tr><tr><td class="line-number" value="1310"></td><td class="line-content">			anim.currentframe = endFrame-1;</td></tr><tr><td class="line-number" value="1311"></td><td class="line-content">		} else {</td></tr><tr><td class="line-number" value="1312"></td><td class="line-content">			anim.currentframe = startFrame;</td></tr><tr><td class="line-number" value="1313"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1314"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1315"></td><td class="line-content">	if (anim.currentframe &lt; startFrame) {</td></tr><tr><td class="line-number" value="1316"></td><td class="line-content">		anim.direction = 1;</td></tr><tr><td class="line-number" value="1317"></td><td class="line-content">		if (anim.pingpong) {</td></tr><tr><td class="line-number" value="1318"></td><td class="line-content">			anim.currentframe = startFrame+1;</td></tr><tr><td class="line-number" value="1319"></td><td class="line-content">			if (anim.currentframe &gt; endFrame) anim.currentframe = endFrame;</td></tr><tr><td class="line-number" value="1320"></td><td class="line-content">		} else {</td></tr><tr><td class="line-number" value="1321"></td><td class="line-content">			anim.currentframe = endFrame;</td></tr><tr><td class="line-number" value="1322"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1323"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1324"></td><td class="line-content">	var ax = anim.currentframe % nrtilesx;</td></tr><tr><td class="line-number" value="1325"></td><td class="line-content">	var ay = Math.floor(anim.currentframe / nrtilesx);</td></tr><tr><td class="line-number" value="1326"></td><td class="line-content">	var canv = document.getElementById("animpreview");</td></tr><tr><td class="line-number" value="1327"></td><td class="line-content">	var ctx = canv.getContext("2d");</td></tr><tr><td class="line-number" value="1328"></td><td class="line-content">	ctx.clearRect(0,0,tilex,tiley);</td></tr><tr><td class="line-number" value="1329"></td><td class="line-content">	ctx.drawImage(spritecanvas,ax*tilex,ay*tiley,tilex,tiley,</td></tr><tr><td class="line-number" value="1330"></td><td class="line-content">			0,0,tilex,tiley);</td></tr><tr><td class="line-number" value="1331"></td><td class="line-content">	var canvzoom = document.getElementById("animpreview_l");</td></tr><tr><td class="line-number" value="1332"></td><td class="line-content">	updateZoomedSprite(canv,canvzoom,0,0,tilex,tiley);</td></tr><tr><td class="line-number" value="1333"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1334"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1335"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1336"></td><td class="line-content">function setOnionSkin() {</td></tr><tr><td class="line-number" value="1337"></td><td class="line-content">	var skin = document.getElementById("setonionskin").checked;</td></tr><tr><td class="line-number" value="1338"></td><td class="line-content">	if (skin) {</td></tr><tr><td class="line-number" value="1339"></td><td class="line-content">		onionskin.src = {x: curtilex, y:curtiley};</td></tr><tr><td class="line-number" value="1340"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="1341"></td><td class="line-content">		onionskin.src = null;</td></tr><tr><td class="line-number" value="1342"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1343"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="1344"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1345"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1346"></td><td class="line-content">// ------------------------------------------------------------</td></tr><tr><td class="line-number" value="1347"></td><td class="line-content">// html manipulation</td></tr><tr><td class="line-number" value="1348"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1349"></td><td class="line-content">function openPopup(popupid,open) {</td></tr><tr><td class="line-number" value="1350"></td><td class="line-content">	var elem = document.getElementById(popupid);</td></tr><tr><td class="line-number" value="1351"></td><td class="line-content">	elem.style.display = open ? "block" : "none";</td></tr><tr><td class="line-number" value="1352"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1353"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1354"></td><td class="line-content">function hasOnionSkin() {</td></tr><tr><td class="line-number" value="1355"></td><td class="line-content">	if (!onionskin.src) return false;</td></tr><tr><td class="line-number" value="1356"></td><td class="line-content">	return onionskin.src.x != curtilex || onionskin.src.y != curtiley;</td></tr><tr><td class="line-number" value="1357"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1358"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1359"></td><td class="line-content">function createPixelDiv(x,y) {</td></tr><tr><td class="line-number" value="1360"></td><td class="line-content">	var div = document.createElement("div");</td></tr><tr><td class="line-number" value="1361"></td><td class="line-content">	if (x==0) div.style.clear="both";</td></tr><tr><td class="line-number" value="1362"></td><td class="line-content">	div.style.cssFloat="left";</td></tr><tr><td class="line-number" value="1363"></td><td class="line-content">	div.style.width=zoomlevel+"px";</td></tr><tr><td class="line-number" value="1364"></td><td class="line-content">	div.style.height=zoomlevel+"px";</td></tr><tr><td class="line-number" value="1365"></td><td class="line-content">	var bgcolor = pickColor(curtilex*tilex + x,curtiley*tiley + y);</td></tr><tr><td class="line-number" value="1366"></td><td class="line-content">	if (hasOnionSkin()) {</td></tr><tr><td class="line-number" value="1367"></td><td class="line-content">		bgcolor[3] *= onionskin.fgTrans;</td></tr><tr><td class="line-number" value="1368"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1369"></td><td class="line-content">	div.style.backgroundColor = getRGBAString(bgcolor);</td></tr><tr><td class="line-number" value="1370"></td><td class="line-content">	div.className = "pixel noselect";</td></tr><tr><td class="line-number" value="1371"></td><td class="line-content">	div.style.border = gridthickness+"px solid "+gridcolor;</td></tr><tr><td class="line-number" value="1372"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="1373"></td><td class="line-content">	function pixelMouseEvent(e,mousepressed) {</td></tr><tr><td class="line-number" value="1374"></td><td class="line-content">		//e.preventDefault();</td></tr><tr><td class="line-number" value="1375"></td><td class="line-content">		// buttons not defined in older versions of Chrome, so we use</td></tr><tr><td class="line-number" value="1376"></td><td class="line-content">		// mousepressed as a fallback</td></tr><tr><td class="line-number" value="1377"></td><td class="line-content">		// https://bugs.chromium.org/p/chromium/issues/detail?id=276941</td></tr><tr><td class="line-number" value="1378"></td><td class="line-content">		if (!mousepressed &amp;&amp; !e.buttons) return;</td></tr><tr><td class="line-number" value="1379"></td><td class="line-content">		if (curCommand) {</td></tr><tr><td class="line-number" value="1380"></td><td class="line-content">			window["command"+curCommand](x,y);</td></tr><tr><td class="line-number" value="1381"></td><td class="line-content">			closeCommand();</td></tr><tr><td class="line-number" value="1382"></td><td class="line-content">			return;</td></tr><tr><td class="line-number" value="1383"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1384"></td><td class="line-content">		var col = pickColor(curtilex*tilex + x,curtiley*tiley + y);</td></tr><tr><td class="line-number" value="1385"></td><td class="line-content">		var pen = [pencolor[0],pencolor[1],pencolor[2],pencolor[3]];</td></tr><tr><td class="line-number" value="1386"></td><td class="line-content">		if (col[3]!=0 &amp;&amp; prevclick.x==x &amp;&amp; prevclick.y==y) {</td></tr><tr><td class="line-number" value="1387"></td><td class="line-content">			pen = [0,0,0,0];</td></tr><tr><td class="line-number" value="1388"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1389"></td><td class="line-content">		var samecol =    col[0]==pen[0] &amp;&amp; col[1]==pen[1]</td></tr><tr><td class="line-number" value="1390"></td><td class="line-content">					  &amp;&amp; col[2]==pen[2] &amp;&amp; col[3]==pen[3];</td></tr><tr><td class="line-number" value="1391"></td><td class="line-content">		setColor(spritecanvas,1,curtilex*tilex + x,curtiley*tiley + y,pen);</td></tr><tr><td class="line-number" value="1392"></td><td class="line-content">		setColor(spritecanvaszoom,sprzoomlevel,</td></tr><tr><td class="line-number" value="1393"></td><td class="line-content">			curtilex*tilex + x,curtiley*tiley + y, pen);</td></tr><tr><td class="line-number" value="1394"></td><td class="line-content">		setColorPreviews(x,y,pen);</td></tr><tr><td class="line-number" value="1395"></td><td class="line-content">		if (hasOnionSkin()) {</td></tr><tr><td class="line-number" value="1396"></td><td class="line-content">			pen[3] *= onionskin.fgTrans;</td></tr><tr><td class="line-number" value="1397"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1398"></td><td class="line-content">		div.style.backgroundColor = getRGBAString(pen);</td></tr><tr><td class="line-number" value="1399"></td><td class="line-content">		prevclick.x = x;</td></tr><tr><td class="line-number" value="1400"></td><td class="line-content">		prevclick.y = y;</td></tr><tr><td class="line-number" value="1401"></td><td class="line-content">		if (!samecol) storeHistory(true);</td></tr><tr><td class="line-number" value="1402"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1403"></td><td class="line-content">	div.addEventListener("mousedown",function(e) {pixelMouseEvent(e,true); } );</td></tr><tr><td class="line-number" value="1404"></td><td class="line-content">	div.addEventListener("mouseover",function(e) {pixelMouseEvent(e,false); });</td></tr><tr><td class="line-number" value="1405"></td><td class="line-content">	//div.addEventListener("touchstart",pixelMouseEvent);</td></tr><tr><td class="line-number" value="1406"></td><td class="line-content">	//div.addEventListener("touchmove",pixelMouseEvent);</td></tr><tr><td class="line-number" value="1407"></td><td class="line-content">	var bgdiv = createBGDiv(zoomlevel);</td></tr><tr><td class="line-number" value="1408"></td><td class="line-content">	if (hasOnionSkin()) {</td></tr><tr><td class="line-number" value="1409"></td><td class="line-content">		var onion = createOnionDiv(x,y);</td></tr><tr><td class="line-number" value="1410"></td><td class="line-content">		div.appendChild(onion);</td></tr><tr><td class="line-number" value="1411"></td><td class="line-content">		div.appendChild(bgdiv);</td></tr><tr><td class="line-number" value="1412"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="1413"></td><td class="line-content">		div.appendChild(bgdiv);</td></tr><tr><td class="line-number" value="1414"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1415"></td><td class="line-content">	return div;</td></tr><tr><td class="line-number" value="1416"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1417"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1418"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1419"></td><td class="line-content">function createPaletteDiv(idx,color) {</td></tr><tr><td class="line-number" value="1420"></td><td class="line-content">	var div = document.createElement("div");</td></tr><tr><td class="line-number" value="1421"></td><td class="line-content">	if (idx%(palettecolors.length&lt;=48 ? 8 : (palettecolors.length==66?11 : 12))</td></tr><tr><td class="line-number" value="1422"></td><td class="line-content">	    == 0) div.style.clear="both";</td></tr><tr><td class="line-number" value="1423"></td><td class="line-content">	div.style.cssFloat="left";</td></tr><tr><td class="line-number" value="1424"></td><td class="line-content">	div.style.width=zoomlevel+"px";</td></tr><tr><td class="line-number" value="1425"></td><td class="line-content">	div.style.height=zoomlevel+"px";</td></tr><tr><td class="line-number" value="1426"></td><td class="line-content">	div.style.backgroundColor = getRGBAString(color);</td></tr><tr><td class="line-number" value="1427"></td><td class="line-content">	div.className = "pixel noselect";</td></tr><tr><td class="line-number" value="1428"></td><td class="line-content">	div.style.border = gridthickness+"px solid "+gridcolor;</td></tr><tr><td class="line-number" value="1429"></td><td class="line-content">	div.addEventListener("click",function(e) {</td></tr><tr><td class="line-number" value="1430"></td><td class="line-content">		pencolor = palettecolors[idx];</td></tr><tr><td class="line-number" value="1431"></td><td class="line-content">		prevclick = {x:-1,y:-1};</td></tr><tr><td class="line-number" value="1432"></td><td class="line-content">		updatePenColor();</td></tr><tr><td class="line-number" value="1433"></td><td class="line-content">	});</td></tr><tr><td class="line-number" value="1434"></td><td class="line-content">	div.appendChild(createBGDiv(zoomlevel));</td></tr><tr><td class="line-number" value="1435"></td><td class="line-content">	return div;</td></tr><tr><td class="line-number" value="1436"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1437"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1438"></td><td class="line-content">function createBGDiv(zoom) {</td></tr><tr><td class="line-number" value="1439"></td><td class="line-content">	var div = document.createElement("div");</td></tr><tr><td class="line-number" value="1440"></td><td class="line-content">	div.style.position="relative";</td></tr><tr><td class="line-number" value="1441"></td><td class="line-content">	div.style.width=zoom+"px";</td></tr><tr><td class="line-number" value="1442"></td><td class="line-content">	div.style.height=zoom+"px";</td></tr><tr><td class="line-number" value="1443"></td><td class="line-content">	div.className = "sprite-bg noselect";</td></tr><tr><td class="line-number" value="1444"></td><td class="line-content">	return div;</td></tr><tr><td class="line-number" value="1445"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1446"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1447"></td><td class="line-content">function createOnionDiv(x,y) {</td></tr><tr><td class="line-number" value="1448"></td><td class="line-content">	var div = document.createElement("div");</td></tr><tr><td class="line-number" value="1449"></td><td class="line-content">	div.style.position="absolute";</td></tr><tr><td class="line-number" value="1450"></td><td class="line-content">	var ofs = 0.5 - onionskin.size*0.5;</td></tr><tr><td class="line-number" value="1451"></td><td class="line-content">	div.style.width=Math.floor(zoomlevel*onionskin.size)+"px";</td></tr><tr><td class="line-number" value="1452"></td><td class="line-content">	div.style.height=Math.floor(zoomlevel*onionskin.size)+"px";</td></tr><tr><td class="line-number" value="1453"></td><td class="line-content">	div.style.marginTop=(-1+Math.floor(zoomlevel*ofs))+"px";</td></tr><tr><td class="line-number" value="1454"></td><td class="line-content">	div.style.marginLeft=(-1+Math.floor(zoomlevel*ofs))+"px";</td></tr><tr><td class="line-number" value="1455"></td><td class="line-content">	var bgcolor= pickColor(onionskin.src.x*tilex + x,onionskin.src.y*tiley + y);</td></tr><tr><td class="line-number" value="1456"></td><td class="line-content">	bgcolor[3] *= onionskin.bgTrans;</td></tr><tr><td class="line-number" value="1457"></td><td class="line-content">	if (bgcolor[3]) div.style.border = "1px solid "+gridcolor;</td></tr><tr><td class="line-number" value="1458"></td><td class="line-content">	div.style.backgroundColor = getRGBAString(bgcolor);</td></tr><tr><td class="line-number" value="1459"></td><td class="line-content">	div.className = "onionskin-bg noselect";</td></tr><tr><td class="line-number" value="1460"></td><td class="line-content">	return div;</td></tr><tr><td class="line-number" value="1461"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1462"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1463"></td><td class="line-content">function updatePalette() {</td></tr><tr><td class="line-number" value="1464"></td><td class="line-content">	palette.innerHTML = "";</td></tr><tr><td class="line-number" value="1465"></td><td class="line-content">	for (var i=0; i&lt;palettecolors.length; i++) {</td></tr><tr><td class="line-number" value="1466"></td><td class="line-content">		var div = createPaletteDiv(i,palettecolors[i]);</td></tr><tr><td class="line-number" value="1467"></td><td class="line-content">		palette.appendChild(div);</td></tr><tr><td class="line-number" value="1468"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1469"></td><td class="line-content">	updateSpriteBG();</td></tr><tr><td class="line-number" value="1470"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1471"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1472"></td><td class="line-content">// ------------------------------------------------------------</td></tr><tr><td class="line-number" value="1473"></td><td class="line-content">// load/save</td></tr><tr><td class="line-number" value="1474"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1475"></td><td class="line-content">function exportImage() {</td></tr><tr><td class="line-number" value="1476"></td><td class="line-content">	var select = document.getElementById("textfiletype").selectedIndex;</td></tr><tr><td class="line-number" value="1477"></td><td class="line-content">	if (select==0) {</td></tr><tr><td class="line-number" value="1478"></td><td class="line-content">		exportDataUrl(false);</td></tr><tr><td class="line-number" value="1479"></td><td class="line-content">	} else if (select==1) {</td></tr><tr><td class="line-number" value="1480"></td><td class="line-content">		exportDataUrl(true);</td></tr><tr><td class="line-number" value="1481"></td><td class="line-content">	} else { // 2</td></tr><tr><td class="line-number" value="1482"></td><td class="line-content">		exportImagePuzzleScript();</td></tr><tr><td class="line-number" value="1483"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1484"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1485"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1486"></td><td class="line-content">function importImage() {</td></tr><tr><td class="line-number" value="1487"></td><td class="line-content">	var select = document.getElementById("textfiletype").selectedIndex;</td></tr><tr><td class="line-number" value="1488"></td><td class="line-content">	if (select==0) {</td></tr><tr><td class="line-number" value="1489"></td><td class="line-content">		setImageFromDataUrl(dataurl.value);</td></tr><tr><td class="line-number" value="1490"></td><td class="line-content">	} else if (select==1) {</td></tr><tr><td class="line-number" value="1491"></td><td class="line-content">		var url = dataurl.value.split(/\s+/);</td></tr><tr><td class="line-number" value="1492"></td><td class="line-content">		if (url.length &gt;= 1) setImageFromDataUrl(url[url.length-1]);</td></tr><tr><td class="line-number" value="1493"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="1494"></td><td class="line-content">		setImageFromPuzzleScript(dataurl.value);</td></tr><tr><td class="line-number" value="1495"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1496"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1497"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1498"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1499"></td><td class="line-content">// currently only used for IE save png. </td></tr><tr><td class="line-number" value="1500"></td><td class="line-content">function getBlobFromImage() {</td></tr><tr><td class="line-number" value="1501"></td><td class="line-content">	if (document.getElementById("imgloadsavetarget").selectedIndex) {</td></tr><tr><td class="line-number" value="1502"></td><td class="line-content">		copySpriteToBuffer(opbuffer);</td></tr><tr><td class="line-number" value="1503"></td><td class="line-content">		return opbuffer.msToBlob();</td></tr><tr><td class="line-number" value="1504"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="1505"></td><td class="line-content">		return spritecanvas.msToBlob();</td></tr><tr><td class="line-number" value="1506"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1507"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1508"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1509"></td><td class="line-content">function getDataUrlFromImage() {</td></tr><tr><td class="line-number" value="1510"></td><td class="line-content">	if (document.getElementById("imgloadsavetarget").selectedIndex) {</td></tr><tr><td class="line-number" value="1511"></td><td class="line-content">		copySpriteToBuffer(opbuffer);</td></tr><tr><td class="line-number" value="1512"></td><td class="line-content">		return opbuffer.toDataURL();</td></tr><tr><td class="line-number" value="1513"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="1514"></td><td class="line-content">		return spritecanvas.toDataURL();</td></tr><tr><td class="line-number" value="1515"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1516"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1517"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1518"></td><td class="line-content">function exportDataUrl(cellscript) {</td></tr><tr><td class="line-number" value="1519"></td><td class="line-content">	var val = getDataUrlFromImage();</td></tr><tr><td class="line-number" value="1520"></td><td class="line-content">	if (cellscript) </td></tr><tr><td class="line-number" value="1521"></td><td class="line-content">		val = "tilemap: "+tilex+" "+tiley+" "+nrtilesx+" "+nrtilesy</td></tr><tr><td class="line-number" value="1522"></td><td class="line-content">		+" false "+val;</td></tr><tr><td class="line-number" value="1523"></td><td class="line-content">	dataurl.value = val;</td></tr><tr><td class="line-number" value="1524"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1525"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1526"></td><td class="line-content">function setImageFromDataUrl(url,target) {</td></tr><tr><td class="line-number" value="1527"></td><td class="line-content">	var img = new Image();</td></tr><tr><td class="line-number" value="1528"></td><td class="line-content">	img.onload = function() {</td></tr><tr><td class="line-number" value="1529"></td><td class="line-content">		ctx = spritecanvas.getContext("2d");</td></tr><tr><td class="line-number" value="1530"></td><td class="line-content">		if ( (target &amp;&amp; target=="sprite")</td></tr><tr><td class="line-number" value="1531"></td><td class="line-content">		||   (!target </td></tr><tr><td class="line-number" value="1532"></td><td class="line-content">		      &amp;&amp; document.getElementById("imgloadsavetarget").selectedIndex)</td></tr><tr><td class="line-number" value="1533"></td><td class="line-content">		) {</td></tr><tr><td class="line-number" value="1534"></td><td class="line-content">			ctx.drawImage(img,0,0,tilex,tiley,</td></tr><tr><td class="line-number" value="1535"></td><td class="line-content">				tilex*curtilex,tiley*curtiley,tilex,tiley);</td></tr><tr><td class="line-number" value="1536"></td><td class="line-content">		} else {</td></tr><tr><td class="line-number" value="1537"></td><td class="line-content">			// fill canvas with transparency</td></tr><tr><td class="line-number" value="1538"></td><td class="line-content">			updateCanvasSize(spritecanvas,1);</td></tr><tr><td class="line-number" value="1539"></td><td class="line-content">			updateCanvasSize(spritecanvaszoom,sprzoomlevel);</td></tr><tr><td class="line-number" value="1540"></td><td class="line-content">			ctx.drawImage(img, 0, 0);</td></tr><tr><td class="line-number" value="1541"></td><td class="line-content">			updateTileSelect("tileselect",1);</td></tr><tr><td class="line-number" value="1542"></td><td class="line-content">			updateTileSelect("tileselect_l",sprzoomlevel);</td></tr><tr><td class="line-number" value="1543"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1544"></td><td class="line-content">		storeHistory();</td></tr><tr><td class="line-number" value="1545"></td><td class="line-content">		updateZoomedSprite();</td></tr><tr><td class="line-number" value="1546"></td><td class="line-content">		updateZoom();</td></tr><tr><td class="line-number" value="1547"></td><td class="line-content">		updatePreviews();</td></tr><tr><td class="line-number" value="1548"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1549"></td><td class="line-content">	//img.crossOrigin='';</td></tr><tr><td class="line-number" value="1550"></td><td class="line-content">	img.src = url;</td></tr><tr><td class="line-number" value="1551"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1552"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1553"></td><td class="line-content">function exportImagePuzzleScript() {</td></tr><tr><td class="line-number" value="1554"></td><td class="line-content">	var tx1=0, ty1=0, txlen=nrtilesx,tylen=nrtilesy;</td></tr><tr><td class="line-number" value="1555"></td><td class="line-content">	if (document.getElementById("imgloadsavetarget").selectedIndex) {</td></tr><tr><td class="line-number" value="1556"></td><td class="line-content">		tx1=curtilex;</td></tr><tr><td class="line-number" value="1557"></td><td class="line-content">		ty1=curtiley;</td></tr><tr><td class="line-number" value="1558"></td><td class="line-content">		txlen=1;</td></tr><tr><td class="line-number" value="1559"></td><td class="line-content">		tylen=1;</td></tr><tr><td class="line-number" value="1560"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1561"></td><td class="line-content">	var out="";</td></tr><tr><td class="line-number" value="1562"></td><td class="line-content">	for (var ty=ty1; ty&lt;ty1+tylen; ty++) {</td></tr><tr><td class="line-number" value="1563"></td><td class="line-content">		for (var tx=tx1; tx&lt;tx1+txlen; tx++) {</td></tr><tr><td class="line-number" value="1564"></td><td class="line-content">			var outname = spritenames[tx+","+ty];</td></tr><tr><td class="line-number" value="1565"></td><td class="line-content">			if (!outname) outname = "Sprite_"+tx+"_"+ty;</td></tr><tr><td class="line-number" value="1566"></td><td class="line-content">			var data = spritecanvas.getContext("2d").getImageData(</td></tr><tr><td class="line-number" value="1567"></td><td class="line-content">				tx*tilex,ty*tiley,tilex,tiley).data;</td></tr><tr><td class="line-number" value="1568"></td><td class="line-content">			var outpalette = "";</td></tr><tr><td class="line-number" value="1569"></td><td class="line-content">			var outgrid = "";</td></tr><tr><td class="line-number" value="1570"></td><td class="line-content">			var idx=0;</td></tr><tr><td class="line-number" value="1571"></td><td class="line-content">			var palidx=0;</td></tr><tr><td class="line-number" value="1572"></td><td class="line-content">			var outpalmap = {};</td></tr><tr><td class="line-number" value="1573"></td><td class="line-content">			var empty=true;</td></tr><tr><td class="line-number" value="1574"></td><td class="line-content">			var hasTransparent=false;</td></tr><tr><td class="line-number" value="1575"></td><td class="line-content">			for (var y=0; y&lt;tiley; y++) {</td></tr><tr><td class="line-number" value="1576"></td><td class="line-content">				for (var x=0; x&lt;tilex; x++) {</td></tr><tr><td class="line-number" value="1577"></td><td class="line-content">					var pix = [data[idx],data[idx+1],data[idx+2],data[idx+3]];</td></tr><tr><td class="line-number" value="1578"></td><td class="line-content">					if (pix[3]!=0) {</td></tr><tr><td class="line-number" value="1579"></td><td class="line-content">					 	empty=false;</td></tr><tr><td class="line-number" value="1580"></td><td class="line-content">						var pixstr = getPuzzleScriptString(pix);</td></tr><tr><td class="line-number" value="1581"></td><td class="line-content">						if (!outpalmap[pixstr] &amp;&amp; outpalmap[pixstr]!==0) {</td></tr><tr><td class="line-number" value="1582"></td><td class="line-content">							outpalette += pixstr + " ";</td></tr><tr><td class="line-number" value="1583"></td><td class="line-content">							outpalmap[pixstr] = palidx++;</td></tr><tr><td class="line-number" value="1584"></td><td class="line-content">						}</td></tr><tr><td class="line-number" value="1585"></td><td class="line-content">						outgrid += outpalmap[pixstr];</td></tr><tr><td class="line-number" value="1586"></td><td class="line-content">					} else {</td></tr><tr><td class="line-number" value="1587"></td><td class="line-content">						outgrid += ".";</td></tr><tr><td class="line-number" value="1588"></td><td class="line-content">						hasTransparent=true;</td></tr><tr><td class="line-number" value="1589"></td><td class="line-content">					}</td></tr><tr><td class="line-number" value="1590"></td><td class="line-content">					idx += 4;</td></tr><tr><td class="line-number" value="1591"></td><td class="line-content">				}</td></tr><tr><td class="line-number" value="1592"></td><td class="line-content">				outgrid += "\n";</td></tr><tr><td class="line-number" value="1593"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1594"></td><td class="line-content">			if (!empty) {</td></tr><tr><td class="line-number" value="1595"></td><td class="line-content">				if (palidx==1 &amp;&amp; !hasTransparent) {</td></tr><tr><td class="line-number" value="1596"></td><td class="line-content">					// only one color -&gt; do not output grid</td></tr><tr><td class="line-number" value="1597"></td><td class="line-content">					out += outname + "\n" + outpalette + "\n\n";</td></tr><tr><td class="line-number" value="1598"></td><td class="line-content">				} else {</td></tr><tr><td class="line-number" value="1599"></td><td class="line-content">					out += outname + "\n" + outpalette + "\n" + outgrid + "\n";</td></tr><tr><td class="line-number" value="1600"></td><td class="line-content">				}</td></tr><tr><td class="line-number" value="1601"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1602"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1603"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1604"></td><td class="line-content">	dataurl.value = out;</td></tr><tr><td class="line-number" value="1605"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1606"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1607"></td><td class="line-content">function getPuzzleScriptString(pix) {</td></tr><tr><td class="line-number" value="1608"></td><td class="line-content">	var pal = palettes["Puzzlescript"];</td></tr><tr><td class="line-number" value="1609"></td><td class="line-content">	for (var i=0; i&lt;pal.length; i++) {</td></tr><tr><td class="line-number" value="1610"></td><td class="line-content">		if (pix[0]==pal[i][0] &amp;&amp; pix[1]==pal[i][1] &amp;&amp; pix[2]==pal[i][2]) {</td></tr><tr><td class="line-number" value="1611"></td><td class="line-content">			return puzzlescriptcolornames[i];</td></tr><tr><td class="line-number" value="1612"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1613"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1614"></td><td class="line-content">	return getHexString(pix,true);</td></tr><tr><td class="line-number" value="1615"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1616"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1617"></td><td class="line-content">function puzzleScriptStringToPixel(col) {</td></tr><tr><td class="line-number" value="1618"></td><td class="line-content">	col = col.toLowerCase();</td></tr><tr><td class="line-number" value="1619"></td><td class="line-content">	for (var i=0; i&lt;puzzlescriptcolornames.length; i++) {</td></tr><tr><td class="line-number" value="1620"></td><td class="line-content">		if (puzzlescriptcolornames[i] == col)</td></tr><tr><td class="line-number" value="1621"></td><td class="line-content">			return palettes["Puzzlescript"][i];</td></tr><tr><td class="line-number" value="1622"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1623"></td><td class="line-content">	return getColorFromHexString(col);</td></tr><tr><td class="line-number" value="1624"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1625"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1626"></td><td class="line-content">function setImageFromPuzzleScript(value) {</td></tr><tr><td class="line-number" value="1627"></td><td class="line-content">	var tx = 0, ty = 0;</td></tr><tr><td class="line-number" value="1628"></td><td class="line-content">	var ctx = spritecanvas.getContext("2d");</td></tr><tr><td class="line-number" value="1629"></td><td class="line-content">	if (document.getElementById("imgloadsavetarget").selectedIndex) {</td></tr><tr><td class="line-number" value="1630"></td><td class="line-content">		tx=curtilex;</td></tr><tr><td class="line-number" value="1631"></td><td class="line-content">		ty=curtiley;</td></tr><tr><td class="line-number" value="1632"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="1633"></td><td class="line-content">		ctx.clearRect(0,0,nrtilesx*tilex,nrtilesy*tiley);</td></tr><tr><td class="line-number" value="1634"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1635"></td><td class="line-content">	var lines = value.split(/\r?\n/);</td></tr><tr><td class="line-number" value="1636"></td><td class="line-content">	lines.push("Closing Dummy");</td></tr><tr><td class="line-number" value="1637"></td><td class="line-content">	var sprline=0;</td></tr><tr><td class="line-number" value="1638"></td><td class="line-content">	var sprname,pal;</td></tr><tr><td class="line-number" value="1639"></td><td class="line-content">	//var data = new Uint8ClampedArray(tilex * tiley * 4);</td></tr><tr><td class="line-number" value="1640"></td><td class="line-content">	var dataobj = ctx.createImageData(tilex, tiley);</td></tr><tr><td class="line-number" value="1641"></td><td class="line-content">	//dataobj.data.set(data);</td></tr><tr><td class="line-number" value="1642"></td><td class="line-content">	var data = dataobj.data;</td></tr><tr><td class="line-number" value="1643"></td><td class="line-content">	var idx=0;</td></tr><tr><td class="line-number" value="1644"></td><td class="line-content">	for (var i=0; i&lt;lines.length; i++) {</td></tr><tr><td class="line-number" value="1645"></td><td class="line-content">		var line = lines[i].replace(/\([^\)]*\)/,"").trim();</td></tr><tr><td class="line-number" value="1646"></td><td class="line-content">		if (line == "") continue;</td></tr><tr><td class="line-number" value="1647"></td><td class="line-content">		// check if there is image data, if not, it's a single-color sprite</td></tr><tr><td class="line-number" value="1648"></td><td class="line-content">		if (sprline==2 &amp;&amp; !/^[0-9.]+$/.test(line)) {</td></tr><tr><td class="line-number" value="1649"></td><td class="line-content">			if (pal.length != 1) {</td></tr><tr><td class="line-number" value="1650"></td><td class="line-content">				alert("Single-pixel sprite must have one color!");</td></tr><tr><td class="line-number" value="1651"></td><td class="line-content">				return;</td></tr><tr><td class="line-number" value="1652"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1653"></td><td class="line-content">			for (var j=0; j&lt;tilex*tiley; j++) {</td></tr><tr><td class="line-number" value="1654"></td><td class="line-content">				data[idx  ] = pal[0][0];</td></tr><tr><td class="line-number" value="1655"></td><td class="line-content">				data[idx+1] = pal[0][1];</td></tr><tr><td class="line-number" value="1656"></td><td class="line-content">				data[idx+2] = pal[0][2];</td></tr><tr><td class="line-number" value="1657"></td><td class="line-content">				data[idx+3] = pal[0][3];</td></tr><tr><td class="line-number" value="1658"></td><td class="line-content">				idx += 4;</td></tr><tr><td class="line-number" value="1659"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1660"></td><td class="line-content">			sprline=0;</td></tr><tr><td class="line-number" value="1661"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1662"></td><td class="line-content">		if (sprline==0) {</td></tr><tr><td class="line-number" value="1663"></td><td class="line-content">			if (idx &gt; 0) {</td></tr><tr><td class="line-number" value="1664"></td><td class="line-content">				// write previous sprite data</td></tr><tr><td class="line-number" value="1665"></td><td class="line-content">				ctx.putImageData(dataobj, tilex*tx, tiley*ty);</td></tr><tr><td class="line-number" value="1666"></td><td class="line-content">				spritenames[tx+","+ty] = sprname;</td></tr><tr><td class="line-number" value="1667"></td><td class="line-content">				tx++;</td></tr><tr><td class="line-number" value="1668"></td><td class="line-content">				if (tx &gt;= nrtilesx) {</td></tr><tr><td class="line-number" value="1669"></td><td class="line-content">					tx = 0;</td></tr><tr><td class="line-number" value="1670"></td><td class="line-content">					ty++;</td></tr><tr><td class="line-number" value="1671"></td><td class="line-content">				}</td></tr><tr><td class="line-number" value="1672"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1673"></td><td class="line-content">			sprname = line;</td></tr><tr><td class="line-number" value="1674"></td><td class="line-content">			idx=0;</td></tr><tr><td class="line-number" value="1675"></td><td class="line-content">		} else if (sprline==1) {</td></tr><tr><td class="line-number" value="1676"></td><td class="line-content">			pal = [];</td></tr><tr><td class="line-number" value="1677"></td><td class="line-content">			palnames = line.split(/\s+/);</td></tr><tr><td class="line-number" value="1678"></td><td class="line-content">			for (var j=0; j&lt;palnames.length; j++) {</td></tr><tr><td class="line-number" value="1679"></td><td class="line-content">				var palname = palnames[j].toLowerCase().replace("gray","grey");</td></tr><tr><td class="line-number" value="1680"></td><td class="line-content">				pal[j] = puzzleScriptStringToPixel(palname);</td></tr><tr><td class="line-number" value="1681"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1682"></td><td class="line-content">		} else { // 2 or higher</td></tr><tr><td class="line-number" value="1683"></td><td class="line-content">			if (line.length &lt; tilex) {</td></tr><tr><td class="line-number" value="1684"></td><td class="line-content">				alert("Pixel row too short!");</td></tr><tr><td class="line-number" value="1685"></td><td class="line-content">				return;</td></tr><tr><td class="line-number" value="1686"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1687"></td><td class="line-content">			for (var j=0; j&lt;tilex; j++) {</td></tr><tr><td class="line-number" value="1688"></td><td class="line-content">				var pixi = line.charAt(j);</td></tr><tr><td class="line-number" value="1689"></td><td class="line-content">				var col = [0,0,0,0];</td></tr><tr><td class="line-number" value="1690"></td><td class="line-content">				if (pixi!=".") {</td></tr><tr><td class="line-number" value="1691"></td><td class="line-content">					col = pal[pixi.charCodeAt(0) - "0".charCodeAt(0)];</td></tr><tr><td class="line-number" value="1692"></td><td class="line-content">				}</td></tr><tr><td class="line-number" value="1693"></td><td class="line-content">				data[idx  ] = col[0];</td></tr><tr><td class="line-number" value="1694"></td><td class="line-content">				data[idx+1] = col[1];</td></tr><tr><td class="line-number" value="1695"></td><td class="line-content">				data[idx+2] = col[2];</td></tr><tr><td class="line-number" value="1696"></td><td class="line-content">				data[idx+3] = col[3];</td></tr><tr><td class="line-number" value="1697"></td><td class="line-content">				idx += 4;</td></tr><tr><td class="line-number" value="1698"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1699"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1700"></td><td class="line-content">		sprline = (sprline+1) % (tiley+2);</td></tr><tr><td class="line-number" value="1701"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1702"></td><td class="line-content">	// write final sprite</td></tr><tr><td class="line-number" value="1703"></td><td class="line-content">	//if (idx &gt; 0) {</td></tr><tr><td class="line-number" value="1704"></td><td class="line-content">	//	spritecanvas.getContext("2d").putImageData(dataobj,</td></tr><tr><td class="line-number" value="1705"></td><td class="line-content">	//		tilex*tx, tiley*ty);</td></tr><tr><td class="line-number" value="1706"></td><td class="line-content">	//}</td></tr><tr><td class="line-number" value="1707"></td><td class="line-content">	storeHistory();</td></tr><tr><td class="line-number" value="1708"></td><td class="line-content">	updateZoomedSprite();</td></tr><tr><td class="line-number" value="1709"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="1710"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="1711"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1712"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1713"></td><td class="line-content">function loadPNG(files) {</td></tr><tr><td class="line-number" value="1714"></td><td class="line-content">	if (files.length==0) return;</td></tr><tr><td class="line-number" value="1715"></td><td class="line-content">	var reader = new FileReader();</td></tr><tr><td class="line-number" value="1716"></td><td class="line-content">	reader.onload = function(e) {</td></tr><tr><td class="line-number" value="1717"></td><td class="line-content">		setImageFromDataUrl(e.target.result);</td></tr><tr><td class="line-number" value="1718"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1719"></td><td class="line-content">	reader.readAsDataURL(files[0]);</td></tr><tr><td class="line-number" value="1720"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1721"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1722"></td><td class="line-content">function savePNG(elem) {</td></tr><tr><td class="line-number" value="1723"></td><td class="line-content">	var filename = prompt("Please enter filename (.png is added)","image");</td></tr><tr><td class="line-number" value="1724"></td><td class="line-content">	if (!filename) return false;</td></tr><tr><td class="line-number" value="1725"></td><td class="line-content">	if (!filename.match(/[.][pP][nN][gG]$/)) filename += ".png";</td></tr><tr><td class="line-number" value="1726"></td><td class="line-content">	if (navigator.msSaveBlob &amp;&amp; spritecanvas.msToBlob) { // IE</td></tr><tr><td class="line-number" value="1727"></td><td class="line-content">		navigator.msSaveBlob(getBlobFromImage(),filename);</td></tr><tr><td class="line-number" value="1728"></td><td class="line-content">		return false;</td></tr><tr><td class="line-number" value="1729"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="1730"></td><td class="line-content">		elem.download = filename;</td></tr><tr><td class="line-number" value="1731"></td><td class="line-content">		elem.href = getDataUrlFromImage();</td></tr><tr><td class="line-number" value="1732"></td><td class="line-content">		return true;</td></tr><tr><td class="line-number" value="1733"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1734"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1735"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1736"></td><td class="line-content">// ------------------------------------------------------------</td></tr><tr><td class="line-number" value="1737"></td><td class="line-content">// image ops</td></tr><tr><td class="line-number" value="1738"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1739"></td><td class="line-content">function getRGBAString(pixel) {</td></tr><tr><td class="line-number" value="1740"></td><td class="line-content">	return "rgba("+pixel[0]+","+pixel[1]+","+pixel[2]+","+(pixel[3]/255)+")";</td></tr><tr><td class="line-number" value="1741"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1742"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1743"></td><td class="line-content">function getHexString(pixel,noalpha) {</td></tr><tr><td class="line-number" value="1744"></td><td class="line-content">	var color=0x1000000*pixel[3] + 0x10000*pixel[0] + 0x100*pixel[1] + pixel[2];</td></tr><tr><td class="line-number" value="1745"></td><td class="line-content">	var colorstr = color.toString(16);</td></tr><tr><td class="line-number" value="1746"></td><td class="line-content">	while (colorstr.length &lt; 8) colorstr = "0"+colorstr;</td></tr><tr><td class="line-number" value="1747"></td><td class="line-content">	return "#" + (!noalpha ? colorstr : colorstr.substr(2) );</td></tr><tr><td class="line-number" value="1748"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1749"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1750"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1751"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1752"></td><td class="line-content">function pickColor(x,y) {</td></tr><tr><td class="line-number" value="1753"></td><td class="line-content">	return spritecanvas.getContext("2d").getImageData(x, y, 1, 1).data;</td></tr><tr><td class="line-number" value="1754"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1755"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1756"></td><td class="line-content">function setColor(elem,zoom,x,y,color) {</td></tr><tr><td class="line-number" value="1757"></td><td class="line-content">	var ctx = elem.getContext("2d");</td></tr><tr><td class="line-number" value="1758"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1759"></td><td class="line-content">	/*var id = ctx.createImageData(zoom,zoom);// only do this once per page</td></tr><tr><td class="line-number" value="1760"></td><td class="line-content">	var d  = id.data;// only do this once per page</td></tr><tr><td class="line-number" value="1761"></td><td class="line-content">	for (var idx=0; idx&lt;zoom*zoom*4; idx+=4) {</td></tr><tr><td class="line-number" value="1762"></td><td class="line-content">		d[idx  ] = color[0];</td></tr><tr><td class="line-number" value="1763"></td><td class="line-content">		d[idx+1] = color[1];</td></tr><tr><td class="line-number" value="1764"></td><td class="line-content">		d[idx+2] = color[2];</td></tr><tr><td class="line-number" value="1765"></td><td class="line-content">		d[idx+3] = color[3];</td></tr><tr><td class="line-number" value="1766"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1767"></td><td class="line-content">	ctx.putImageData( id, zoom*x, zoom*y );*/</td></tr><tr><td class="line-number" value="1768"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1769"></td><td class="line-content">	ctx.fillStyle = getRGBAString(color);</td></tr><tr><td class="line-number" value="1770"></td><td class="line-content">	ctx.clearRect( zoom*x, zoom*y, zoom, zoom);</td></tr><tr><td class="line-number" value="1771"></td><td class="line-content">	ctx.fillRect( zoom*x, zoom*y, zoom, zoom);</td></tr><tr><td class="line-number" value="1772"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1773"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1774"></td><td class="line-content">function setColorPreviews(x,y,color) {</td></tr><tr><td class="line-number" value="1775"></td><td class="line-content">	for (var ty=0; ty&lt;3; ty++) {</td></tr><tr><td class="line-number" value="1776"></td><td class="line-content">		for (var tx=0; tx&lt;3; tx++) {</td></tr><tr><td class="line-number" value="1777"></td><td class="line-content">			setColor(document.getElementById("tilepreview"),1,</td></tr><tr><td class="line-number" value="1778"></td><td class="line-content">				tilex*tx+x, tiley*ty+y,color);</td></tr><tr><td class="line-number" value="1779"></td><td class="line-content">			setColor(document.getElementById("tilepreview_l"),sprzoomlevel,</td></tr><tr><td class="line-number" value="1780"></td><td class="line-content">				tilex*tx+x, tiley*ty+y,color);</td></tr><tr><td class="line-number" value="1781"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1782"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1783"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1784"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1785"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1786"></td><td class="line-content">function replaceColor(color) {</td></tr><tr><td class="line-number" value="1787"></td><td class="line-content">	for (var y=0; y&lt;tiley; y++) {</td></tr><tr><td class="line-number" value="1788"></td><td class="line-content">		for (var x=0; x&lt;tilex; x++) {</td></tr><tr><td class="line-number" value="1789"></td><td class="line-content">			var col = pickColor(curtilex*tilex + x,curtiley*tiley + y);</td></tr><tr><td class="line-number" value="1790"></td><td class="line-content">			if (col[0]==color[0]&amp;&amp;col[1]==color[1]&amp;&amp;col[2]==color[2]) {</td></tr><tr><td class="line-number" value="1791"></td><td class="line-content">				setColor(spritecanvas,1,</td></tr><tr><td class="line-number" value="1792"></td><td class="line-content">					curtilex*tilex + x,</td></tr><tr><td class="line-number" value="1793"></td><td class="line-content">					curtiley*tiley + y, pencolor);</td></tr><tr><td class="line-number" value="1794"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1795"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1796"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1797"></td><td class="line-content">	storeHistory();</td></tr><tr><td class="line-number" value="1798"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="1799"></td><td class="line-content">	updateZoomedSprite();</td></tr><tr><td class="line-number" value="1800"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="1801"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1802"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1803"></td><td class="line-content">function createBinaryMap(matchcol) {</td></tr><tr><td class="line-number" value="1804"></td><td class="line-content">	var map = [];</td></tr><tr><td class="line-number" value="1805"></td><td class="line-content">	for (var y=0; y&lt;tiley; y++) {</td></tr><tr><td class="line-number" value="1806"></td><td class="line-content">		map.push([]);</td></tr><tr><td class="line-number" value="1807"></td><td class="line-content">		for (var x=0; x&lt;tilex; x++) {</td></tr><tr><td class="line-number" value="1808"></td><td class="line-content">			var col = pickColor(curtilex*tilex + x,curtiley*tiley + y);</td></tr><tr><td class="line-number" value="1809"></td><td class="line-content">			map[y].push(   col[0]==matchcol[0] &amp;&amp; col[1]==matchcol[1]</td></tr><tr><td class="line-number" value="1810"></td><td class="line-content">					    &amp;&amp; col[2]==matchcol[2] &amp;&amp; col[3]==matchcol[3]);</td></tr><tr><td class="line-number" value="1811"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1812"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1813"></td><td class="line-content">	return map;</td></tr><tr><td class="line-number" value="1814"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1815"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1816"></td><td class="line-content">function createOutline() {</td></tr><tr><td class="line-number" value="1817"></td><td class="line-content">	var map = createBinaryMap([0,0,0,0]);</td></tr><tr><td class="line-number" value="1818"></td><td class="line-content">	//alert(JSON.stringify(map));</td></tr><tr><td class="line-number" value="1819"></td><td class="line-content">	for (var y=0; y&lt;tiley; y++) {</td></tr><tr><td class="line-number" value="1820"></td><td class="line-content">		for (var x=0; x&lt;tilex; x++) {</td></tr><tr><td class="line-number" value="1821"></td><td class="line-content">			if (!map[y][x]) continue;</td></tr><tr><td class="line-number" value="1822"></td><td class="line-content">			if( (x&gt;0 &amp;&amp; !map[y][x-1])</td></tr><tr><td class="line-number" value="1823"></td><td class="line-content">			||  (x&lt;tilex-1 &amp;&amp; !map[y][x+1])</td></tr><tr><td class="line-number" value="1824"></td><td class="line-content">			||  (y&gt;0 &amp;&amp; !map[y-1][x])</td></tr><tr><td class="line-number" value="1825"></td><td class="line-content">			||  (y&lt;tiley-1 &amp;&amp; !map[y+1][x])</td></tr><tr><td class="line-number" value="1826"></td><td class="line-content">			) {</td></tr><tr><td class="line-number" value="1827"></td><td class="line-content">				setColor(spritecanvas,1,</td></tr><tr><td class="line-number" value="1828"></td><td class="line-content">					curtilex*tilex + x,</td></tr><tr><td class="line-number" value="1829"></td><td class="line-content">					curtiley*tiley + y, pencolor);</td></tr><tr><td class="line-number" value="1830"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1831"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1832"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1833"></td><td class="line-content">	storeHistory();</td></tr><tr><td class="line-number" value="1834"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="1835"></td><td class="line-content">	updateZoomedSprite();</td></tr><tr><td class="line-number" value="1836"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="1837"></td><td class="line-content">	//alert(JSON.stringify(map));</td></tr><tr><td class="line-number" value="1838"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1839"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1840"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1841"></td><td class="line-content">function opFuncShift(x,y,par) {</td></tr><tr><td class="line-number" value="1842"></td><td class="line-content">	return {</td></tr><tr><td class="line-number" value="1843"></td><td class="line-content">		x: (tilex + x - par.dx)%tilex,</td></tr><tr><td class="line-number" value="1844"></td><td class="line-content">		y: (tiley + y - par.dy)%tiley,</td></tr><tr><td class="line-number" value="1845"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1846"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1847"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1848"></td><td class="line-content">function opFuncFlip(x,y,par) {</td></tr><tr><td class="line-number" value="1849"></td><td class="line-content">	return {</td></tr><tr><td class="line-number" value="1850"></td><td class="line-content">		x:  par.vertical ? x : tilex - 1 - x,</td></tr><tr><td class="line-number" value="1851"></td><td class="line-content">		y: !par.vertical ? y : tiley - 1 - y,</td></tr><tr><td class="line-number" value="1852"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1853"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1854"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1855"></td><td class="line-content">function opFuncRot(x,y,par) {</td></tr><tr><td class="line-number" value="1856"></td><td class="line-content">	return {</td></tr><tr><td class="line-number" value="1857"></td><td class="line-content">		x: par.dir&lt;0 ?  tilex - 1 - y  : y,</td></tr><tr><td class="line-number" value="1858"></td><td class="line-content">		y: par.dir&lt;0 ?  x              :tiley - 1 - x,</td></tr><tr><td class="line-number" value="1859"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1860"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1861"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1862"></td><td class="line-content">function opFuncDelRow(x,y,par) {</td></tr><tr><td class="line-number" value="1863"></td><td class="line-content">	if (y == tiley-1) return "clear";</td></tr><tr><td class="line-number" value="1864"></td><td class="line-content">	return {</td></tr><tr><td class="line-number" value="1865"></td><td class="line-content">		x: x,</td></tr><tr><td class="line-number" value="1866"></td><td class="line-content">		y: y&lt;par.row ? y : (y+1)%tiley,</td></tr><tr><td class="line-number" value="1867"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1868"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1869"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1870"></td><td class="line-content">function opFuncDelColumn(x,y,par) {</td></tr><tr><td class="line-number" value="1871"></td><td class="line-content">	if (x == tilex-1) return "clear";</td></tr><tr><td class="line-number" value="1872"></td><td class="line-content">	return {</td></tr><tr><td class="line-number" value="1873"></td><td class="line-content">		x: x&lt;par.col ? x : (x+1)%tilex,</td></tr><tr><td class="line-number" value="1874"></td><td class="line-content">		y: y,</td></tr><tr><td class="line-number" value="1875"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1876"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1877"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1878"></td><td class="line-content">function opFuncInsRow(x,y,par) {</td></tr><tr><td class="line-number" value="1879"></td><td class="line-content">	if (y == par.row) return "pen";</td></tr><tr><td class="line-number" value="1880"></td><td class="line-content">	return {</td></tr><tr><td class="line-number" value="1881"></td><td class="line-content">		x: x,</td></tr><tr><td class="line-number" value="1882"></td><td class="line-content">		y: y&lt;par.row ? y : y-1,</td></tr><tr><td class="line-number" value="1883"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1884"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1885"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1886"></td><td class="line-content">function opFuncInsColumn(x,y,par) {</td></tr><tr><td class="line-number" value="1887"></td><td class="line-content">	if (x == par.col) return "pen";</td></tr><tr><td class="line-number" value="1888"></td><td class="line-content">	return {</td></tr><tr><td class="line-number" value="1889"></td><td class="line-content">		x: x&lt;par.col ? x : x-1,</td></tr><tr><td class="line-number" value="1890"></td><td class="line-content">		y: y,</td></tr><tr><td class="line-number" value="1891"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1892"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1893"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1894"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1895"></td><td class="line-content">function opFuncCopyMirrorX(x,y,par) {</td></tr><tr><td class="line-number" value="1896"></td><td class="line-content">	return {</td></tr><tr><td class="line-number" value="1897"></td><td class="line-content">		x: x&lt;tilex/2 ? x : tilex - 1 - x,</td></tr><tr><td class="line-number" value="1898"></td><td class="line-content">		y: y,</td></tr><tr><td class="line-number" value="1899"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1900"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1901"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1902"></td><td class="line-content">function opFuncCopyMirrorY(x,y,par) {</td></tr><tr><td class="line-number" value="1903"></td><td class="line-content">	return {</td></tr><tr><td class="line-number" value="1904"></td><td class="line-content">		x: x,</td></tr><tr><td class="line-number" value="1905"></td><td class="line-content">		y: y&lt;tiley/2 ? y : tiley - 1 - y,</td></tr><tr><td class="line-number" value="1906"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1907"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1908"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1909"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1910"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1911"></td><td class="line-content">function transformSprite(op,param) {</td></tr><tr><td class="line-number" value="1912"></td><td class="line-content">	copySpriteToBuffer(opbuffer);</td></tr><tr><td class="line-number" value="1913"></td><td class="line-content">	var data = opbuffer.getContext("2d").getImageData(0,0,tilex,tiley).data;</td></tr><tr><td class="line-number" value="1914"></td><td class="line-content">	for (var y=0; y&lt;tiley; y++) {</td></tr><tr><td class="line-number" value="1915"></td><td class="line-content">		for (var x=0; x&lt;tilex; x++) {</td></tr><tr><td class="line-number" value="1916"></td><td class="line-content">			var srcpos = window["opFunc"+op](x,y,param);</td></tr><tr><td class="line-number" value="1917"></td><td class="line-content">			var col;</td></tr><tr><td class="line-number" value="1918"></td><td class="line-content">			if (srcpos == "clear") {</td></tr><tr><td class="line-number" value="1919"></td><td class="line-content">				col = [0,0,0,0];</td></tr><tr><td class="line-number" value="1920"></td><td class="line-content">			} else if (srcpos == "pen") {</td></tr><tr><td class="line-number" value="1921"></td><td class="line-content">				col = pencolor;</td></tr><tr><td class="line-number" value="1922"></td><td class="line-content">			} else {</td></tr><tr><td class="line-number" value="1923"></td><td class="line-content">				var idx = 4*(srcpos.x + tilex*srcpos.y);</td></tr><tr><td class="line-number" value="1924"></td><td class="line-content">				col = [data[idx],data[idx+1],data[idx+2],data[idx+3]];</td></tr><tr><td class="line-number" value="1925"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="1926"></td><td class="line-content">			setColor(spritecanvas,1,curtilex*tilex + x,curtiley*tiley + y,col);</td></tr><tr><td class="line-number" value="1927"></td><td class="line-content">			</td></tr><tr><td class="line-number" value="1928"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="1929"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="1930"></td><td class="line-content">	storeHistory();</td></tr><tr><td class="line-number" value="1931"></td><td class="line-content">	updatePreviews();</td></tr><tr><td class="line-number" value="1932"></td><td class="line-content">	updateZoomedSprite();</td></tr><tr><td class="line-number" value="1933"></td><td class="line-content">	updateZoom();</td></tr><tr><td class="line-number" value="1934"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1935"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1936"></td><td class="line-content">function shiftSprite(dx,dy) {</td></tr><tr><td class="line-number" value="1937"></td><td class="line-content">	transformSprite("Shift",{dx:dx,dy:dy});</td></tr><tr><td class="line-number" value="1938"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1939"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1940"></td><td class="line-content">function flipSprite(vertical) {</td></tr><tr><td class="line-number" value="1941"></td><td class="line-content">	transformSprite("Flip",{vertical:vertical});</td></tr><tr><td class="line-number" value="1942"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1943"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1944"></td><td class="line-content">function rotSprite(dir) {</td></tr><tr><td class="line-number" value="1945"></td><td class="line-content">	transformSprite("Rot",{dir:dir});</td></tr><tr><td class="line-number" value="1946"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1947"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1948"></td><td class="line-content">function copyMirrorX() {</td></tr><tr><td class="line-number" value="1949"></td><td class="line-content">	transformSprite("CopyMirrorX");</td></tr><tr><td class="line-number" value="1950"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1951"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1952"></td><td class="line-content">function copyMirrorY() {</td></tr><tr><td class="line-number" value="1953"></td><td class="line-content">	transformSprite("CopyMirrorY");</td></tr><tr><td class="line-number" value="1954"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1955"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1956"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1957"></td><td class="line-content">updatePalette();</td></tr><tr><td class="line-number" value="1958"></td><td class="line-content">updateCanvasSizes();</td></tr><tr><td class="line-number" value="1959"></td><td class="line-content">updatePenColor();</td></tr><tr><td class="line-number" value="1960"></td><td class="line-content">updateSpriteBG();</td></tr><tr><td class="line-number" value="1961"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1962"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1963"></td><td class="line-content"><span class="html-tag">&lt;/body&gt;</span></td></tr><tr><td class="line-number" value="1964"></td><td class="line-content"><span class="html-tag">&lt;/html&gt;</span></td></tr><tr><td class="line-number" value="1965"></td><td class="line-content"><span class="html-end-of-file"></span></td></tr></tbody></table></body></html>